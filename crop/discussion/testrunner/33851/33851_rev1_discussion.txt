DESCRIPTION

CBQE-2602: quota_percent is always initialized to None, instead of param
value passed.
Fixing the basetestcase to handle the case where quota_percent is used
to size the node ram size.

Change-Id: I8e9939c9fdfc6a246eff5e5babb1002381f80d52


COMMENTS

author: Amani Conrad
date: 2014-02-22 01:59:38.516000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2014-02-22 02:12:00.627000000

Patch Set 1: Verified+1

Build Successful 

http://factory.couchbase.com/job/testrunner-Jasmin Rangel-master/583/ : SUCCESS

-------------------------------------
author: Esperanza Cherry
date: 2014-02-22 12:00:29.754000000

Patch Set 1: Code-Review-2

(2 comments)

Line:241, pytests/basetestcase.py -> we pass quota_percent in params. someone calls this function with None?

Line:244, pytests/basetestcase.py -> please remove "e"

-------------------------------------
author: Esperanza Cherry
date: 2014-02-22 12:11:46.689000000

Patch Set 1:

(1 comment)

Line:241, pytests/basetestcase.py -> skip my comment above.
for me old implementation is fine. why we should modify it?

-------------------------------------
author: Amani Conrad
date: 2014-02-24 21:30:24.426000000

Patch Set 1:

(1 comment)

Hi Andre, 

Removed the e.

I need this change for tunable mem, where a smaller bucket quota is preferable over using 2G bucket size with 10 percent DGM. 

While running these tests, I noticed the quota is the default value, no matter what quota_percent is passed

"quota" is set using initialize_node function, where no "quota_percent" is passed explicitly. It picks up default value "None" .. and this imo is incorrect.

Could you explain how this works for you? I have printed the values below which match the above obsv.

self.quota = self._initialize_nodes(self.cluster, self.servers, self.disabled_consistent_view,
                                          self.rebalanceIndexWaitingDisabled, self.rebalanceIndexPausingDisabled,
                                            self.maxParallelIndexers, self.maxParallelReplicaIndexers, self.port)


    def _initialize_nodes(self, cluster, servers, disabled_consistent_view=None, rebalanceIndexWaitingDisabled=None,
                          rebalanceIndexPausingDisabled=None, maxParallelIndexers=None, maxParallelReplicaIndexers=None,
                          port=None, quota_percent=None):

Line:244, pytests/basetestcase.py -> ah yes!

-------------------------------------
author: Esperanza Cherry
date: 2014-02-24 21:44:47.298000000

Patch Set 1:

Thanks Luca Rhodes, now the problem is clear)

I believe that quota_percent param missed in the calling _initialize_nodes. should be :
self.quota = self._initialize_nodes(self.cluster, self.servers, self.disabled_consistent_view,
                                            self.rebalanceIndexWaitingDisabled, self.rebalanceIndexPausingDisabled,
                                            self.maxParallelIndexers, self.maxParallelReplicaIndexers, self.port, self.quota_percent)

how do you think it would help?

-------------------------------------
author: Amani Conrad
date: 2014-02-24 21:48:18.821000000

Patch Set 1:

Yes, that is the better way to handle it.

Will push changes with the initialization code change.

thanks!
Luca Rhodes

-------------------------------------
author: Tate Garrett
date: 2014-02-25 17:06:03.716000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
