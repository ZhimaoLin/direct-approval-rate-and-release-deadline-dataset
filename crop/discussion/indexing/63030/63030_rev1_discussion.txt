DESCRIPTION

MB-19064 : Fix rollback to 0 when some VBs are not rolled back

When Rollback is received by indexer, some of the vbuckets
are not present in rollbackTS which led to those VB seq num
becoming 0 leading to rollback to 0. Fix is to do union of activeTs
with rollbackTs in kv_sender. Also fixed the condition which
led to only latest persisted snapshot being compared in GetOlderThanTS
method

Change-Id: Ia80cba1c08341d106b38806e1e99db5863430b11


COMMENTS

author: Alden Ashley
date: 2016-04-19 12:41:31.828000000

Uploaded patch set 1.

-------------------------------------
author: Maliyah Fischer
date: 2016-04-20 05:03:48.113000000

Patch Set 1:

- This fix may not be sufficient as even after the union of activeTs and rollbackTs, it is not guaranteed we have result for all vbuckets. Projector may not return response for all vbuckets.

- Changes to KVSender::restartVbuckets are not required as that rollbackTs is not used.

-------------------------------------
author: Tate Garrett
date: 2016-04-25 06:19:46.545000000

Change has been successfully merged into the git repository by Alden Ashley

-------------------------------------
