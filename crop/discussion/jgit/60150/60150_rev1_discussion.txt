DESCRIPTION

Fallback exactRef: Do not ignore symrefs to unborn branch

When asked to read a symref pointing to a branch-yet-to-be-born (such
as HEAD in a newly initialized repository), getRef and getRefs provide
different results.

	getRef: SymbolicRef[HEAD -> refs/heads/master=00000000]
	getRefs and getAdditionalRefs: nothing

exactRef should match the getRef behavior: it is meant to be a
simpler, faster version of getRef that lets you search for a ref
without resolving it using the search path without other semantic
changes.  But the fallback implementation of exactRef relis on getRefs
and produces null for this case.

Luckily the in-tree RefDatabase implementations override exactRef and
get the correct behavior.  But any out-of-tree storage backend that
doesn't inherit from DfsRefDatabase or RefDirectory would still return
null when it shouldn't.

Let the fallback implementation use getRef instead to avoid this.
This means that exactRef would waste some effort traversing the ref
search path when the named ref is not found --- but subclasses tend to
override exactRef for performance already, so in the default
implementation correctness is more important.

Bug: 478865
Change-Id: I60f04e3ce3bf4731640ffd2433d329e621330029


COMMENTS

author: Eden Lin
date: 2015-11-11 18:58:38.000000000

Uploaded patch set 1.

-------------------------------------
author: Brenden Conley
date: 2015-11-11 19:05:39.000000000

Patch Set 1:

Build Started https://hudson.eclipse.org/jgit/job/jgit.gerrit/7461/

-------------------------------------
author: Brenden Conley
date: 2015-11-11 19:12:33.000000000

Patch Set 1: Verified+1

Build Successful 

https://hudson.eclipse.org/jgit/job/jgit.gerrit/7461/ : SUCCESS

-------------------------------------
author: Douglas Trujillo
date: 2015-11-12 10:09:00.000000000

Patch Set 1:

Le me know if you want a service release 4.1.1 containing these 2 changes ?
If yes let me know when you are done with the patches you need to fix the Gerrit tests

-------------------------------------
author: Eden Lin
date: 2015-11-12 18:12:24.000000000

Patch Set 1: Verified+1

> Le me know if you want a service release 4.1.1 containing these 2
 > changes ?
 > If yes let me know when you are done with the patches you need to
 > fix the Gerrit tests

Yes, please.

The Gerrit tests use InMemoryRepository (based on DfsRepository) which
already got this fix in d0e47a99 (https://git.eclipse.org/r/52115).
After https://gerrit-review.googlesource.com/72401 the tests pass.
End users using FileRepository would need these two changes.

-------------------------------------
author: Eden Lin
date: 2015-11-12 19:33:35.000000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Beau Terry
date: 2015-11-12 19:42:30.000000000

Patch Set 1: Code-Review+1

-------------------------------------
author: Douglas Trujillo
date: 2015-11-12 19:45:30.000000000

Patch Set 1: Code-Review-1

(1 comment)

Line:19, /COMMIT_MSG -> s/relis/relies/

-------------------------------------
author: Gerrit Code Review
date: 2015-11-12 20:00:24.000000000

Change has been successfully merged into the git repository by Eden Lin

-------------------------------------
author: Eden Lin
date: 2015-11-12 20:00:55.000000000

Patch Set 1:

(1 comment)

Thanks.

Line:19, /COMMIT_MSG -> Done

-------------------------------------
