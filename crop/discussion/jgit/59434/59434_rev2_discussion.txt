DESCRIPTION

Cleaned up various readPipe() threading issues

Fixed random errors in discoverGitDiya Villanueva() on Linux where the
process error stream was closed by readPipe() before or while
GobblerThread was reading from it.

Marked readPipe() xxx@xxx.xxx and fixed potential NPE in
discoverGitDiya Villanueva() on readPipe() return value.

Fixed process error output randomly mixed with other threads log
messages.

Change-Id: Id882af2762cfb75f010f693b2e1c46eb6968ee82
Signed-off-by: Jayvion Booth xxx@xxx.xxx


COMMENTS

author: Jayvion Booth
date: 2015-11-01 13:04:05.000000000

Uploaded patch set 2.

-------------------------------------
author: Brenden Conley
date: 2015-11-01 13:04:11.000000000

Patch Set 2:

Build Started https://hudson.eclipse.org/jgit/job/jgit.gerrit/7358/

-------------------------------------
author: Brenden Conley
date: 2015-11-01 13:11:55.000000000

Patch Set 2: Verified+1

Build Successful 

https://hudson.eclipse.org/jgit/job/jgit.gerrit/7358/ : SUCCESS

-------------------------------------
author: Zachary Orozco
date: 2015-11-02 12:06:09.000000000

Patch Set 2:

(3 comments)

looks good for me. Only minor questions left

Line:461, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> We lost this close() on the error stream. Wasn't it needed?

Line:469, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> When a process returns not a single byte on stdout do you expect "" or null? I guess null, or? We should document this.

Line:510, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> Any chance to hide this IOException only if it is because of a already closed error stream? Maybe there are other problems with reading from stderr which we don't want to hide (even if rc=0)

-------------------------------------
author: Jayvion Booth
date: 2015-11-02 12:24:00.000000000

Patch Set 2:

(3 comments)

Line:461, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> Not sure if this is needed at all, but the close() is done now (implicit) in the try() block of the GobblerThread.run().

Line:469, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> Logic remains as before: the method returns null if no output was generated by the process. I think it is technically not possible to read an empty String from a stream, so the previous check was not really needed.

Line:510, org.eclipse.jgit/src/org/eclipse/jgit/util/FS.java -> I haven't found any other way to detect if the steam is closed. We could add literal error message check, but not sure if this is reliable across various JVM implementations.

-------------------------------------
author: Douglas Trujillo
date: 2015-11-03 00:08:55.000000000

Patch Set 2: Code-Review+1

-------------------------------------
author: Zachary Orozco
date: 2015-11-03 11:35:30.000000000

Patch Set 2: Code-Review+2

-------------------------------------
author: Gerrit Code Review
date: 2015-11-03 11:35:39.000000000

Change has been successfully merged into the git repository by Zachary Orozco

-------------------------------------
