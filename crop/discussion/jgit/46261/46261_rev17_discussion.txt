DESCRIPTION

Add support to follow HTTP redirects

git-core follows HTTP redirects so JGit should also provide this.

Implement config setting http.followRedirects with possible values
"false" (= never), "true" (= always), and "initial" (only on GET, but
not on POST).[1]

We must do our own redirect handling and cannot rely on the support
that the underlying real connection may offer. At least the JDK's
HttpURLConnection has two features that get in the way:

* it does not allow cross-protocol redirects and thus fails on
  http->https redirects (for instance, on Github).
* it translates a redirect after a POST to a GET unless the system
  property "http.strictPostRedirect" is set to true. We don't want
  to manipulate that system setting nor require it.

Additionally, git has its own rules about what redirects it accepts;[2]
for instance, it does not allow a redirect that adds query arguments.

We handle response codes 301, 302, 303, and 307 as per RFC 2616.[3]
On POST we do not handle 303, and we follow redirects only if
http.followRedirects == true.

Redirects are followed only a certain number of times. There are two
ways to control that limit:

* by default, the limit is given by the http.maxRedirects system
  property that is also used by the JDK. If the system property is
  not set, the default is 5. (This is much lower than the JDK default
  of 20, but I don't see the value of following so many redirects.)
* this can be overwritten by a http.maxRedirects git config setting.

The JGit http.* git config settings are currently all global; JGit has
no support yet for URI-specific settings "http.<pattern>.name". Adding
support for that is well beyond the scope of this change.

Like git-core, we log every redirect attempt (LOG.info) so that users
may know about the redirection having occurred.

Extends the test framework to configure an AppServer with HTTPS support
so that we can test cloning via HTTPS and redirections involving HTTPS.

[1] https://git-scm.com/docs/git-config
[2]
https://kernel.googlesource.com/pub/scm/git/git/+/6628eb41db5189c0cdfdced6d8697e7c813c5f0f
[3] https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html

CQ: 13987
Bug: 465167
Change-Id: I86518cb76842f7d326b51f8715e3bbf8ada89859
Signed-off-by: Douglas Trujillo xxx@xxx.xxx
Signed-off-by: Alayna Houston xxx@xxx.xxx


COMMENTS

author: Douglas Trujillo
date: 2017-08-10 22:27:51.000000000

Uploaded patch set 17: Commit message was updated.

-------------------------------------
author: Brenden Conley
date: 2017-08-10 22:27:58.000000000

Patch Set 17:

Build Started https://ci.eclipse.org/jgit/job/jgit.gerrit/10949/

-------------------------------------
author: Douglas Trujillo
date: 2017-08-10 22:28:40.000000000

Patch Set 17: Code-Review+1

filed CQ since change has > 1000 LoC

-------------------------------------
author: Brenden Conley
date: 2017-08-10 22:40:25.000000000

Patch Set 17: Verified+1

Build Successful 

https://ci.eclipse.org/jgit/job/jgit.gerrit/10949/ : SUCCESS

-------------------------------------
author: Alayna Houston
date: 2017-08-11 05:58:16.000000000

Patch Set 17:

(1 comment)

Line:53, /COMMIT_MSG xxx@xxx.xxx maybe use EGit nightly to avoid such line wrapping? ;-)

-------------------------------------
author: Douglas Trujillo
date: 2017-08-11 06:53:14.000000000

Patch Set 17:

(1 comment)

Line:53, /COMMIT_MSG -> yes, I need to update, I used a too old nightly

-------------------------------------
