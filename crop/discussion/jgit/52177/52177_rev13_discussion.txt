DESCRIPTION

Support LFS protocol and a file system based LFS storage

Implement LfsProtocolServlet handling the "Git LFS v1 Batch API"
protocol [1]. Add a simple file system based LFS content store and the
debug-lfs-store command to simplify testing.

Introduce a LargeFileRepository interface to enable additional storage
implementation while reusing the same protocol implementation.

At the client side we have to configure the lfs.url, specify that
we use the batch API and we don't use authentication:

  [lfs]
	  url = http://host:port/lfs
	  batch = true
  [lfs "http://host:port/lfs"]
	  access = none

the git-lfs client appends the "objects/batch" to the lfs.url.

Hard code an Authorization header in the PlainFSRepository.getHeaders
because then git-lfs client will skip asking for credentials. It will
just forward the Authorization header from the response to the
download/upload request.

The LargeObjectServlet supports file content storage for "Large File
Storage" (LFS) server as defined by the Github LFS API [2].

- upload and download of large files is probably network bound hence use
  an asynchronous servlet for good scalability
- simple object storage in file system with 2 level fan-out
- use LockFile to protect writing large objects against multiple
  concurrent uploads of the same object
- to prevent corrupt uploads the uploaded file is rejected if its hash
  doesn't match id given in URL

The debug-lfs-store command is used to run the LfsProtocolServlet and,
optionally, the LargeObjectServlet which makes it easier to setup a
local test server.

[1]
https://github.com/github/git-lfs/blob/master/docs/api/http-v1-batch.md
[2] https://github.com/github/git-lfs/tree/master/docs/api

Bug: 472961
Change-Id: I7378da5575159d2195138d799704880c5c82d5f3
Signed-off-by: Douglas Trujillo xxx@xxx.xxx
Signed-off-by: Dillon Cross xxx@xxx.xxx


COMMENTS

author: Douglas Trujillo
date: 2016-01-27 01:42:15.000000000

Uploaded patch set 13.

-------------------------------------
author: Brenden Conley
date: 2016-01-27 01:52:11.000000000

Patch Set 13:

Build Started https://hudson.eclipse.org/jgit/job/jgit.gerrit/7993/

-------------------------------------
author: Brenden Conley
date: 2016-01-27 02:08:25.000000000

Patch Set 13: Verified+1

Build Successful 

https://hudson.eclipse.org/jgit/job/jgit.gerrit/7993/ : SUCCESS

-------------------------------------
author: Gerrit Code Review
date: 2016-02-04 21:08:43.000000000

Change has been successfully merged into the git repository by Douglas Trujillo

-------------------------------------
