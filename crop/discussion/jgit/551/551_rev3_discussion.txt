DESCRIPTION

Fix ReceivePack setEnsureProvidedObjectsVisible on thin packs

If ensureProvidedObjectsVisible is enabled we expected any trees or
blobs directly reachable from an advertised reference to be marked
with UNINTERESTING.  Unfortunately ObjectWalk doesn't bother setting
this until the traversal is complete.  Even then it won't necessarily
set it on every tree if the corresponding commit wasn't popped.

When we are going to check the base objects for the received pack,
ensure the UNINTERESTING flag gets carried into every immediately
reachable tree or blob, because these are the ones that the client
might try to use as delta bases in a thin pack.

Change-Id: I5d5fdcf07e25ac9fc360e79a25dff491925e4101
Signed-off-by: Jaycee Hickman xxx@xxx.xxx


COMMENTS

author: Yoselin Hanna
date: 2010-04-14 23:53:56.000000000

Uploaded patch set 3.

-------------------------------------
author: Yoselin Hanna
date: 2010-04-15 00:19:03.000000000

Patch Set 3: Looks good to me, but someone else must approve; Unclean IP, do not check in

I can't reproduce the bug anymore using the proper JGit build within Gerrit Code Review.  Also, since the unit test passes, and is nearly full code coverage, I'd say its pretty likely to be correct at this point.

-------------------------------------
author: Yoselin Hanna
date: 2010-04-15 00:19:08.000000000

Patch Set 3: IP review completed



-------------------------------------
author: Maddison Bishop
date: 2010-04-15 17:22:40.000000000

Patch Set 3: Looks good to me, but someone else must approve



-------------------------------------
author: Gerrit Code Review
date: 2010-04-20 01:19:07.000000000

Your change requires a recursive merge to resolve.

Please merge (or rebase) the change locally and upload the resolution for review.

-------------------------------------
