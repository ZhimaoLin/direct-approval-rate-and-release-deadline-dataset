DESCRIPTION

ReceivePack: Fix push options received over HTTP

Capabilities are not transmitted during the POST request that contains
the commands and pack data, which caused the pushOptions list to stay
initialized as null.

Refactor all of the push option support code to allocate the list
immediately before parsing the options section off the stream.

Move option support down to ReceivePack instead of BaseReceivePack.
Push options are specific to the ReceivePack protocol and are not
likely to appear in the 4 year old subscription proposal.  These
changes are OK before JGit 4.5 ships as no consumer should be relying
on these new APIs.

One test (testFailedAtomicPushWithOptions) changes its behavior by
this, as getPushOpptions returns null when the usePushOptions flag
is not set. It is not set as the push aborts early due to not being
atomic.

[sb: fixed test]
Change-Id: Ib07d18c877628aba07da07cd91875f918d509c49
Signed-off-by: Beau Terry xxx@xxx.xxx


COMMENTS

author: Beau Terry
date: 2016-08-26 21:44:53.000000000

Uploaded patch set 3.

-------------------------------------
author: Brenden Conley
date: 2016-08-26 21:44:59.000000000

Patch Set 3:

Build Started https://hudson.eclipse.org/jgit/job/jgit.gerrit/9050/

-------------------------------------
author: Eden Lin
date: 2016-08-26 21:46:36.000000000

Patch Set 3: Code-Review-1

I prefer when the change that refactors and the change that is intended to change behavior are separate. That makes review easier, makes it easier to understand the code later, and makes it easier to solve problems if one of the two has a bug.

I like the refactoring this change does, FWIW.

-------------------------------------
author: Yoselin Hanna
date: 2016-08-26 21:54:24.000000000

Patch Set 3:

> I prefer when the change that refactors and the change that is
 > intended to change behavior are separate. That makes review easier,
 > makes it easier to understand the code later, and makes it easier
 > to solve problems if one of the two has a bug.
 > 
 > I like the refactoring this change does, FWIW.

Done.

-------------------------------------
author: Brenden Conley
date: 2016-08-26 21:55:00.000000000

Patch Set 3: Verified+1

Build Successful 

https://hudson.eclipse.org/jgit/job/jgit.gerrit/9050/ : SUCCESS

-------------------------------------
author: Gerrit Code Review
date: 2016-08-26 22:15:12.000000000

Change has been successfully merged into the git repository by Eden Lin

-------------------------------------
