DESCRIPTION

UploadPack: Verify clients send only commits for shallow lines

If a client mistakenly tries to send a tag object as a shallow line
JGit blindly assumes this is a commit and tries to parse the tag
buffer using the commit parser. This can cause an obtuse error like:

  InvalidObjectIdException: Invalid id: t c0ff331234...

The "t" comes from the "object c0ff331234..." line of the tag tring
to be parsed as though it where the "tree" line of a commit.

Run any client supplied shallow lines through the RevWalk to lookup
the object types. Fail fast with a protocol exception if any of them
are non-commit.

Skip objects not known to this repository. This matches behavior
with git-core's upload-pack, which sliently skips over any shallow
line object named by the client but not known by the server.

Change-Id: Ic6c57a90a42813164ce65c2244705fc42e84d700


COMMENTS

author: Yoselin Hanna
date: 2015-09-14 19:18:43.000000000

Uploaded patch set 2.

-------------------------------------
author: Brenden Conley
date: 2015-09-14 19:18:49.000000000

Patch Set 2:

Build Started https://hudson.eclipse.org/jgit/job/jgit.gerrit/7088/

-------------------------------------
author: Brenden Conley
date: 2015-09-14 19:26:14.000000000

Patch Set 2: Verified+1

Build Successful 

https://hudson.eclipse.org/jgit/job/jgit.gerrit/7088/ : SUCCESS

-------------------------------------
author: Eden Lin
date: 2015-09-14 19:52:08.000000000

Patch Set 2:

(2 comments)

Line:832, org.eclipse.jgit/src/org/eclipse/jgit/transport/UploadPack.java -> What should happen when o == null?

Line:847, org.eclipse.jgit/src/org/eclipse/jgit/transport/UploadPack.java -> (not about this change) sounds like AsyncOperation should be AutoCloseable.

-------------------------------------
author: Yoselin Hanna
date: 2015-09-14 19:54:16.000000000

Patch Set 2:

(2 comments)

Line:832, org.eclipse.jgit/src/org/eclipse/jgit/transport/UploadPack.java -> break; but this version NPEs. Fixed. :)

Line:847, org.eclipse.jgit/src/org/eclipse/jgit/transport/UploadPack.java -> Yes, but much bigger change than this.

-------------------------------------
author: Gerrit Code Review
date: 2015-09-14 20:42:09.000000000

Change has been successfully merged into the git repository by Yoselin Hanna

-------------------------------------
