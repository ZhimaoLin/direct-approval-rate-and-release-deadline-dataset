DESCRIPTION

MB-5264: using persisted Checkpoint ID to ensure full commit

In this change-set, to ensure full commit, XDCR will create a new
checkpoint in ep engine and wait till the persisted checkpoint ID
catch up with the new checkpoint ID. Command CMD_CREATE_CHECKPOINT
is introduced in ns_server to send command to ep engine to create
the new checkpoint and get its ID.

Change-Id: I1d1755cfc8ef578299815ff213d5ecbfa2d187d0


COMMENTS

author: Macie Morton
date: 2012-06-13 00:30:40.904000000

Uploaded patch set 9.

-------------------------------------
author: Macie Morton
date: 2012-06-13 00:32:20.816000000

Patch Set 9:

Please look at PS9

-------------------------------------
author: Nathalie Landry
date: 2012-06-13 00:36:08.819000000

Patch Set 9:

looks ok. Looking forward centralizing stats polling.

Also I think it may make lots of sense to add special stats type in that will efficiently return only stats we need. I.e. startup time and persisted checkpoint for given vbucket.

One extra thing I think may happen is active -> dead transition. It may be quite wrong to try to poll for stats on dead vbucket when we actually need to ensure persistence of active (i.e. potentially on different node).

Perhaps special new stat subcommand can help with that too. I.e. it can also return vbucket state that your code will check and fail if it's not active

-------------------------------------
author: Macie Morton
date: 2012-06-13 00:45:06.267000000

Patch Set 9: Verified

That is very good point. We need to tNathalie Landry to Chiyoung about it. Today we fetch a long list of stats multiple times, most of which we do not need at all. This may cause unnecessary overhead to ep_engine.  Thanks.

-------------------------------------
author: Broderick Chavez
date: 2012-06-13 01:41:33.830000000

Patch Set 9: Looks good to me, approved



-------------------------------------
author: Broderick Chavez
date: 2012-06-13 01:41:42.596000000

Change has been successfully cherry-picked as f3f4cab0a1a83243f16e5f9bb348a84a8821d711.

-------------------------------------
