DESCRIPTION

MB-8039: don't ping tap connections during Harley Martinitor runs

The issue with pinging is that if node is down it may take couple
minutes for us to detect that. And while pinging we had node's
Harley Martinitor_agent blocked.

So when any node was down that caused essentially all other node's
Harley Martinitor agents to be blocked on pinging tap connection from that node
preventing failover actions.

That pinging was originally added to fight rebalance failure right
after node is rebooted. In which case we might have tap replications
from that node, not really aware that they're dead.

In order to fight that issue we're now simply specially detecting
crash from vbucket filter change caused by dead connection. If that
happens we simply establish fresh tap connection (which will kill
named tap producer first).

Change-Id: I5b5c4ddc5c12830dcca596ce9c9c055324332afe
Reviewed-on: http://review.couchbase.org/29051
Tested-by: Nathalie Landry <Nathalie xxx@xxx.xxx
Reviewed-by: Meghan Vazquez xxx@xxx.xxx


COMMENTS

author: Meghan Vazquez
date: 2013-09-19 19:01:08.159000000

Change has been successfully cherry-picked as ae0a17dfc5f9aa979148dbceefd96d3a7eb52a50

-------------------------------------
