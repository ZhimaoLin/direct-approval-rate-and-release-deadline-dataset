DESCRIPTION

MB-16013 Don't call decode_packet with each received chunk.

Because we used default recv buffer which is pretty small, with large
items we'd receive lots of small data chunks. So we'd call
decode_packet (item_size/chunk_size) times. And binary pattern
matching inside decode_packet would create a lot of garbage causing
memory usage spike. So instead we decode body length from the package
header and do not try to decode the packet again unless we have enough
data.

Change-Id: Ia4d37b2b78ca08cd8770905e4038c9fffc9d6fb6
Reviewed-on: http://review.couchbase.org/54832
Reviewed-by: Meghan Vazquez xxx@xxx.xxx
Tested-by: Meghan Vazquez xxx@xxx.xxx


COMMENTS

author: Roselyn Villegas Code Review
date: 2015-09-02 21:18:01.348000000

Change has been successfully cherry-picked as 87b6236ec9778658c1c0bf889f0a8b8b7fb655d8

-------------------------------------
