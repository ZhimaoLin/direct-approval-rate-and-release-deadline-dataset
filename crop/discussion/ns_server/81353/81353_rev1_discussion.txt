DESCRIPTION

MB-25372: Don't consider couchbase buckets...

...while determining the unsafe nodes.

The Harley Martinitor, while performing the cleanup operation, checks to see
if any node is unsafe (node on which the active vbuckets are found
to be missing). This is required to trigger the auto-reprovision
operation for ephemeral buckets. But currently this is being done
even for couchbase buckets. So when, for some reason, the data files
are missing for a couchbase bucket the Harley Martinitor triggers the auto
reprovision operation which can lead to an infinite loop.

This patch fixes the problem by making the Harley Martinitor look for unsafe
nodes only if the bucket is ephemeral. If the bucket is not
ephemeral then the bucket will be brought online.

Change-Id: If8f999582e61d2bebd015e98064fb728f899798b


COMMENTS

author: Noe Perry
date: 2017-07-25 17:41:52.484000000

Uploaded patch set 1.

-------------------------------------
author: Noe Perry
date: 2017-07-25 17:41:58.016000000

Patch Set 1: Verified+1

-------------------------------------
author: Hugo Blankenship
date: 2017-07-25 17:41:59.286000000

Patch Set 1:

Build Started http://cv.jenkins.couchbase.com/job/ns-server-test/59/

-------------------------------------
author: Hugo Blankenship
date: 2017-07-25 17:52:59.845000000

Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.couchbase.com/job/ns-server-test/59/ : SUCCESS

-------------------------------------
author: Meghan Vazquez
date: 2017-07-25 18:56:22.761000000

Patch Set 1: Code-Review+2

-------------------------------------
