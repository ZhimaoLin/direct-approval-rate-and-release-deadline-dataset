DESCRIPTION

MB-9983: control batching of memcached replies in proxy

We now have slightly different proxy protocol that allows proxy on
remote node to be aware of memcached batches.

For that every batch now starts with 32-bit batch size in bytes
followed by 32-bit batch size in requests. Downstream proxy is using
that to accumulate proper count of replies before sending all of them
via single ssl:send call.

We have to break abstractions a bit to support that. Particularly
proxied_memcached_clients_pool has to be aware of batching.

Change-Id: I960d50b884ede1a96b142acc3be268224618ec60


COMMENTS

author: Nathalie Landry
date: 2014-01-22 00:56:01.963000000

Uploaded patch set 2.

-------------------------------------
author: Nathalie Landry
date: 2014-01-22 01:22:41.674000000

Patch Set 2:

there's still some error here:

xxx@xxx.xxx
=========================CRASH REPORT=========================
  crasher:
    initial call: ns_ssl_proxy_server:start_downstream/1
    pid: <0.147.0>
    registered_name: []
    exception error: no match of right hand side value <<"{\"rev\":23,\"name\":\"other\"">>
      in function  ns_ssl_proxy_server:requests_loop_pipe_replies/5
      in call from ns_ssl_proxy_server:requests_loop/2
    ancestors: [ns_ssl_proxy_server_sup,ns_ssl_proxy_sup,<0.29.0>]
    messages: []
    links: [<0.63.0>,#Port<0.7427>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 2584
    stack_size: 24
    reductions: 44676
  neighbours:


which appears to be from bits from not-my-vbucket response

-------------------------------------
