DESCRIPTION

MB-24242: Stop rebalance when auto-failover...

...is initiated.

Currently, while rebalance is in progress if an auto-failover
request is sent (because a node went down) then it'll be simply
ignored. The fix is to terminate the rebalance operation and
process the auto-failover message.

Change-Id: Ice0384a333ef521f7a368766d4112516ba99c871


COMMENTS

author: Noe Perry
date: 2017-06-15 00:41:16.466000000

Uploaded patch set 1.

-------------------------------------
author: Noe Perry
date: 2017-06-15 00:43:29.576000000

Patch Set 1: Verified+1

-------------------------------------
author: Philip Lara
date: 2017-06-16 18:23:53.385000000

Patch Set 1:

(1 comment)

Line:949, src/ns_orchestrator.erl -> I would call it maybe_initiate_rebalance_stop

-------------------------------------
author: Philip Lara
date: 2017-06-16 18:26:47.370000000

Patch Set 1:

(1 comment)

Line:963, src/ns_orchestrator.erl -> I don't understand why do you need this

-------------------------------------
author: Philip Lara
date: 2017-06-16 19:39:24.773000000

Patch Set 1:

(1 comment)

Line:963, src/ns_orchestrator.erl -> I see. this is for cancel_stop_time. nevermind

-------------------------------------
author: Philip Lara
date: 2017-06-16 19:43:47.000000000

Patch Set 1:

By the way, in handle_rebalance_completion stop_timer=undefined is not propagated to maybe_start_service_upgrader. This might be problem. Can you take a look at this?

-------------------------------------
author: Noe Perry
date: 2017-06-16 20:13:43.999000000

Patch Set 1:

(1 comment)

Line:949, src/ns_orchestrator.erl -> Sure! will change

-------------------------------------
author: Noe Perry
date: 2017-06-16 20:26:10.314000000

Patch Set 1:

It seems like the "stop_timer=undefined" not being propagated is fine. The stop_timer field gets over-written the next time "stop_rebalance" message is received. But for completeness sake we should probably clear it. Will make this change as well.

-------------------------------------
