DESCRIPTION

MB-21769: Fix vbstate snap start/end off by one

Recent changes to vbstate writing introduced an edge case regression.
If we force shutdown and had empty active vbuckets, after warmup
we will expose an incorrect failover table as we have an entry
for seq 1, yet the VB has high-seq of 0.

Change-Id: Iee67f71ce46c8eaf4f2cd822103354dcdecc04d8


COMMENTS

author: Jim WNathalie Landryer
date: 2016-11-24 12:14:52.290000000

Uploaded patch set 3.

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 12:15:01.290000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1474/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 12:15:01.573000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1910/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 12:15:01.804000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1692/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 12:15:02.050000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/507/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 12:37:31.556000000

Patch Set 3: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1692/ : FAILURE

Timeout of a CTest test 27/27 Test #19: ep-engine_dcp_tests ...................} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/1692/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1474/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1910/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/507/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 14:15:20.364000000

Patch Set 3: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1693/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 14:15:20.529000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1475/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 14:15:20.688000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1911/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 14:15:20.824000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/508/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 14:40:08.635000000

Patch Set 3: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1693/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/1693/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1475/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1911/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/508/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2016-11-24 15:04:19.357000000

Patch Set 3: Code-Review+2

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 16:46:16.584000000

Patch Set 3: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1696/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 16:46:16.828000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1478/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 16:46:17.103000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1914/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 16:46:17.361000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/511/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 17:12:33.707000000

Patch Set 3: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1696/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1478/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1914/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/511/ : SUCCESS

-------------------------------------
author: Adrianna Holmes
date: 2016-11-24 18:41:34.870000000

Patch Set 3: Code-Review+2

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:26:05.585000000

Patch Set 3: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1697/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:26:05.721000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1479/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:26:05.846000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1915/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:26:05.968000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/512/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:34:44.773000000

Patch Set 3: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1697/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1479/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1915/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/512/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:50:31.314000000

Patch Set 3: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1698/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:50:31.621000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1480/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:50:31.906000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1916/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 21:50:32.056000000

Patch Set 3:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/513/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-24 22:06:37.217000000

Patch Set 3: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1698/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1480/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1916/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/513/ : SUCCESS

-------------------------------------
author: Tate Garrett
date: 2016-11-25 07:56:34.680000000

Change has been successfully cherry-picked as 36d700b1161fbc0afdea6e45e8431ee920704a8c by Ashlee Kent

-------------------------------------
