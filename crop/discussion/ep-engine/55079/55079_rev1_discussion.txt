DESCRIPTION

Bloomfilter: Don't search if StoredValue already found

When using the Bloomfilter to check if a key exists, skip searching if
the StoredValue has already been found.

Change-Id: I479bded3a15e3f20a5bf3f4c878714cb49e1c276


COMMENTS

author: Ashlee Kent
date: 2015-09-07 10:43:20.097000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 10:43:25.059000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/919/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 11:08:25.896000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/919/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 12:33:16.441000000

Patch Set 1: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/921/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 13:02:23.120000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/921/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 14:40:44.668000000

Patch Set 1: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/922/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 14:48:12.245000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/922/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 16:08:59.887000000

Patch Set 1: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/923/

-------------------------------------
author: Emerson Nolan
date: 2015-09-07 18:05:13.858000000

Patch Set 1:

(1 comment)

Line:817, src/ep.cc -> I know you haven't added anyone for review yet, so forgive my intrusion but I thought I should let you know that we should issue a background fetch even if v is non-NULL but is a temp item.

Also all we here do is set maybekeyExists to true. If you see unlocked_set's implementation, we use this variable to decide if we actually need to schedule a background_fetch.

-------------------------------------
author: Hugo Blankenship
date: 2015-09-07 23:21:20.979000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/923/ : FAILURE

-------------------------------------
author: Ashlee Kent
date: 2015-09-08 07:34:26.744000000

Patch Set 1:

(1 comment)

Line:817, src/ep.cc -> So the issue I was trying to avoid was searching the bloom filter (a non-free operation) when it is unnecessary. Based on what you say we /do/ need to search for temp items, but not for non-temp.

Therefore can we change the test to (if v == nullptr || v->isTempItem()) ?

-------------------------------------
author: Emerson Nolan
date: 2015-09-08 16:33:04.092000000

Patch Set 1:

(1 comment)

Line:817, src/ep.cc -> That seems right, more accurately:

if (v == nullptr || v->isTempInitialItem())

-------------------------------------
author: Ashlee Kent
date: 2015-09-21 12:22:51.355000000

Patch Set 1:

(1 comment)

Line:817, src/ep.cc -> Done

-------------------------------------
author: Tate Garrett
date: 2015-09-21 16:16:15.692000000

Change has been successfully cherry-picked as 93da9a19c465dc0d80e84f09877638ad70712e00

-------------------------------------
