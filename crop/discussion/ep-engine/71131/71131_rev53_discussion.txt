DESCRIPTION

Provide an option to include a value while deleting an item

- The store API has been expanded to assign a state for the
  document. Calling this API with DocumentState::Deleted
  and a value will persist the value and the document will
  be in deleted state.
- The get API has been enchanced to retrieve a value
  for a document in deleted state.

Change-Id: I34a0b90f11137263991a2771fb82d6d9234303fd


COMMENTS

author: Bobby Buck
date: 2017-01-10 00:47:09.388000000

Uploaded patch set 53.

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 00:47:18.073000000

Patch Set 53:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1440/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 00:47:18.227000000

Patch Set 53:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2764/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 00:47:18.381000000

Patch Set 53:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2612/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 00:47:18.540000000

Patch Set 53:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2253/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 00:59:08.229000000

Patch Set 53: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2253/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2612/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1440/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2764/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2017-01-10 10:52:31.144000000

Patch Set 53: Code-Review-1

(2 comments)

Line:266, src/ep_engine.h -> I believe `mut_info` must be non-NULL, as it's dereferenced unconditionally in KVBucket::deleteItem.

(You might want to change the argument to a reference so it's clear that it cannot be null.)

Line:230, src/hash_table.h -> I'd suggest changing the order of the optional arguments so the new argument comes last - as otherwise if there's any existing code which calls this function as:

 find(key, /*trackReference*/false);

Then it'll actually end up calling the function with wanteDeleted=false, trackReference=true.

-------------------------------------
author: Bobby Buck
date: 2017-01-10 18:28:57.885000000

Patch Set 53:

(2 comments)

Line:266, src/ep_engine.h -> Sure. I have no issues in making that change. But I would prefer to do it in a separate patch. itemDelete is also called by the engine API (which would also need a change and that will just have more changes outside the scope of the patch).

Line:230, src/hash_table.h -> Done

-------------------------------------
author: Ashlee Kent
date: 2017-01-10 18:35:43.865000000

Patch Set 53:

(1 comment)

Line:266, src/ep_engine.h -> Yeah's that's totally fine :)

-------------------------------------
author: Tate Garrett
date: 2017-01-11 14:39:48.497000000

Change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Tate Garrett
date: 2017-01-11 15:01:30.298000000

Change has been successfully cherry-picked as d3586e47402c4c087afcc426da98bc102373a959 by Ashlee Kent

-------------------------------------
