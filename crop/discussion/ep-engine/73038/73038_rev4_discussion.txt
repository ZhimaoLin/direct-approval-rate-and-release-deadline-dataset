DESCRIPTION

[Refactor]: Do not pass HT lock as a param to VBucket::queueDirty()

VBucket::queueDirty() must just put an item on a queue for persistence
and/or replication. Hence the HT lock and notification logic are removed
from it. It should be upto the VBucket to decide when to release the HT
lock and when to notify any clients of a new seqno

Change-Id: I8e72d74d32190953056609f5991e469b6b909509


COMMENTS

author: Adrianna Holmes
date: 2017-02-02 22:51:40.533000000

Uploaded patch set 4.

-------------------------------------
author: Hugo Blankenship
date: 2017-02-02 22:51:49.963000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3328/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-02-02 22:55:43.390000000

Patch Set 4: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3328/ : FAILURE

Compile error at /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/tests/mock/mock_dcp.cc:340:25:
error: assigning to 'ENGINE_ERROR_CODE (*)(const void *, uint32_t, item *, uint16_t, uint64_t, uint64_t, const void *, uint16_t)' from incompatible type 'ENGINE_ERROR_CODE (const void *, uint32_t, const void *, uint16_t, uint64_t, uint16_t, uint64_t, uint64_t, const void *, uint16_t)': different number of parameters (8 vs 10)
 ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/3328/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/2152/ : FAILURE

Compile error at /home/Piper Jefferson/jenkins/workspace/ep-engine-addresssanitizer-master/ep-engine/tests/mock/mock_dcp.cc:340:25:
error: assigning to 'ENGINE_ERROR_CODE (*)(const void *, uint32_t, item *, uint16_t, uint64_t, uint64_t, const void *, uint16_t)' from incompatible type 'ENGINE_ERROR_CODE (const void *, uint32_t, const void *, uint16_t, uint64_t, uint16_t, uint64_t, uint64_t, const void *, uint16_t)': different number of parameters (8 vs 10)
 ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/2152/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2934/ : FAILURE

Compile error at /home/Piper Jefferson/jenkins/workspace/ep-engine-clang_analyzer-master/ep-engine/tests/mock/mock_dcp.cc:340:25:
error: invalid conversion from 'ENGINE_ERROR_CODE (*)(const void*, uint32_t, const void*, uint16_t, uint64_t, uint16_t, uint64_t, uint64_t, const void*, uint16_t) {aka ENGINE_ERROR_CODE (*)(const void*, unsigned int, const void*, short unsigned int, long unsigned int, short unsigned int, long unsigned int, long unsigned int, const void*, short unsigned int)}' to 'ENGINE_ERROR_CODE (*)(const void*, uint32_t, item*, uint16_t, uint64_t, uint64_t, const void*, uint16_t) {aka ENGINE_ERROR_CODE (*)(const void*, unsigned int, void*, short unsigned int, long unsigned int, long unsigned int, const void*, short unsigned int)}' [-fpermissive]
 ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-clang_analyzer-master/2934/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/3509/ : FAILURE

-------------------------------------
