DESCRIPTION

Ensure events are unregistered when shutting down the engine.

If we teardown and deallocate a connection while the object is still
registered with libevent, an event could fire and pass our invalid
object to our method where we just kind of stomp on memory and do
really dumb stuff.

It's not *entirely* clear that this happened since I can't figure out
how to make it happen myself, but the evidence of this having occurred
is substantial and circumstantial.

Change-Id: I5302b9055d73395efceda1d243252aa792fb40a7


COMMENTS

author: Noah Dean
date: 2011-06-23 05:22:34.624000000

Uploaded patch set 3.

-------------------------------------
author: Asher Vang
date: 2011-06-23 05:33:39.853000000

Patch Set 3:

Yes, but in the case where we didn't successfully register it in the first place (if we never got connected) this could result in calling ev_delete for an incorrect socket, or use rubbish-pointers to ev_base etc?

-------------------------------------
author: Noah Dean
date: 2011-06-23 05:37:01.421000000

Patch Set 3:

Hmm...  If we're positive nothing will ever be registered when flags are 0, then I'll update it.

-------------------------------------
