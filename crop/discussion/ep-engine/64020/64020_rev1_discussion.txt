DESCRIPTION

MB-19605: Check return value for snprintf

snprintf does not return -1 if the buffer is too small, and the
buffer is not zero terminated on windows.

Change-Id: Icbb166385843df0a7d44f815c2c3e5fd8341ded4


COMMENTS

author: Asher Vang
date: 2016-05-13 08:44:31.213000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-05-13 08:44:37.628000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/573/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-05-13 08:44:42.614000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/378/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-05-13 08:46:04.632000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/522/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-05-13 08:57:55.685000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/573/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/378/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/522/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2016-05-13 09:05:45.386000000

Patch Set 1: Code-Review-1

(6 comments)

Looks good - just a few minor comments.

Line:3839, src/ep_engine.cc -> typo.

Also - probably wants to be prefixed with "StatCheckpointVisitor::"

Line:23, src/checked_snprintf.h -> I'd probably not make this inline, given the code to do varargs parsing / build exception might end up quite large.

Line:30, src/checked_snprintf.h -> I believe -1 should set errno - might be worth adding that to the exception string.

Line:33, src/checked_snprintf.h -> Similary, helpful to add the buffer size and needed length to the error string.

Line:787, src/executorpool.cc -> Nit: "stats"

Line:1002, src/dcp/consumer.cc -> Style: I generally use .size() instead of length() on std::string - my reason is that size() exists for all containers (vector, etc), but length only for std::string, and it makes it easier to change code between vector and string if one always uses size().

-------------------------------------
author: Asher Vang
date: 2016-05-13 11:34:09.709000000

Patch Set 1:

(4 comments)

Line:3839, src/ep_engine.cc -> Done

Line:23, src/checked_snprintf.h -> Done, moved to platform (and fixed the other issues here)

Line:787, src/executorpool.cc -> Done

Line:1002, src/dcp/consumer.cc -> Done. I agree (even that it feels more "natural" to use length for a string ;-) )

-------------------------------------
author: Tate Garrett
date: 2016-05-16 16:08:39.668000000

Change has been successfully cherry-picked as 92e6ff749149038c0da8721f2b2bf712747d645e by Ashlee Kent

-------------------------------------
