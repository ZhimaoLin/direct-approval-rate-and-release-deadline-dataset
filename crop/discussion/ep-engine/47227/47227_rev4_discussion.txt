DESCRIPTION

MB-13356: If the buffer is full check to see if we have dead backfills

It's possible that the buffer becomes full because a backfill is still
running for a dead vbucket. If this is the case remove the backfill
from the backfill manager.

Change-Id: I5c248d71d79dd9fd1796d5b39ed714d8253dc410


COMMENTS

author: Kenny Maynard
date: 2015-02-24 18:56:58.372000000

Uploaded patch set 4.

-------------------------------------
author: Hugo Blankenship
date: 2015-02-24 18:57:05.063000000

Patch Set 4:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/59/

-------------------------------------
author: Hugo Blankenship
date: 2015-02-24 19:14:45.150000000

Patch Set 4: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/59/ : FAILURE

-------------------------------------
author: Abby Duran
date: 2015-02-26 00:54:13.138000000

Patch Set 4:

Mike,

Do you want me to review this change while you're verifying it?

-------------------------------------
author: Kenny Maynard
date: 2015-02-26 00:55:44.787000000

Patch Set 4:

Sure.

-------------------------------------
author: Kenny Maynard
date: 2015-02-26 00:55:47.253000000

Removed the following votes:

* Verified-1 by Hugo Blankenship xxx@xxx.xxx Jefferson.com>


-------------------------------------
author: Abby Duran
date: 2015-02-26 01:40:14.259000000

Patch Set 4:

(1 comment)

Line:75, src/dcp-backfill.h -> Under which conditions a stream becomes non-active? For example, the stream is closed by the DCP consumer or a vbucket is deleted, something else?

-------------------------------------
author: Kenny Maynard
date: 2015-02-26 02:51:08.917000000

Patch Set 4:

(1 comment)

The reason I'm doing things this way is to avoid locking issues. We can re-visit these later and try to reduce locking complexity, but given that the code freeze is going to happen soon this is the least risky thing to do.

Line:75, src/dcp-backfill.h -> It becomes active if one of the following is true:

1. There are no more mutations to send.
2. The connection is disconnected.
3. The vbucket that the stream is streaming from changes state.
4. The stream is closed due to receiving the close stream command.

-------------------------------------
author: Tate Garrett
date: 2015-02-26 21:48:05.626000000

Change has been successfully cherry-picked as bc34a8855cb8d8e70ed54192a3b4c505855ba6da

-------------------------------------
