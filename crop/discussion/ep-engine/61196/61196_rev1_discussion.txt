DESCRIPTION

MB-18625: Do not queue mutations into readyQ after a STREAM_END

Once an active stream has been closed, and a STREAM_END message has
been added into the active stream's readyQ, its checkpoint processer
task that may have been scheduled should not add any more items into
the readyQ.

Change-Id: I48901781c93e7ed167688e04c5370b4a13efa249


COMMENTS

author: Emerson Nolan
date: 2016-03-09 21:26:50.325000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 21:27:00.006000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/55/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 21:27:18.124000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/40/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 21:27:18.906000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/73/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 21:50:25.458000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/74/ (3/3)

-------------------------------------
author: Abby Duran
date: 2016-03-09 21:51:12.036000000

Patch Set 1: Code-Review+2

(1 comment)

Line:783, src/dcp/stream.cc -> I think we agree to use C++ 11 style iteration.

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:00:28.224000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/56/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:21:49.609000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/56/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/74/ : FAILURE

Timeout of a CTest test 21/24 Test #21: ep-engine_dcp_tests .................} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/74/ )

Failure of a CTest test 15/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/74/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/40/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:23:07.852000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/57/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:23:07.982000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:23:08.111000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/75/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:50:56.832000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/57/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/75/ : FAILURE

Timeout of a CTest test 23/24 Test #23: ep-engine_perfsuite .................} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/75/ )

Failure of a CTest test 14/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/75/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 22:51:39.435000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 23:00:06.765000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/75/ : FAILURE

Timeout of a CTest test 23/24 Test #23: ep-engine_perfsuite .................} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/75/ )

Failure of a CTest test 14/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/75/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 23:00:35.069000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/76/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 23:24:20.573000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/76/ : FAILURE

Failure of a CTest test 16/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/76/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 23:29:02.803000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/77/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-09 23:54:20.457000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/77/ : FAILURE

Timeout of a CTest test 22/24 Test #21: ep-engine_dcp_tests .................} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/77/ )

Failure of a CTest test 15/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/77/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 00:02:20.212000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/78/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 00:29:48.693000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/78/ : FAILURE

Failure of a CTest test 16/24 Test  #8: ep-engine_hash_table_test ........... ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/78/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 16:59:11.440000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/103/ (3/3)

-------------------------------------
author: Ashlee Kent
date: 2016-03-10 17:16:18.741000000

Patch Set 1: Code-Review+1

(1 comment)

Looks good. I assume the testcase fails before the change to stream.cc ?

Line:315, tests/module_tests/dcp_test.cc -> Nit: Safer to use std::unique_ptr<DcpResponse> - then you don't need to remember to call delete later on.

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 17:16:36.953000000

Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/58/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/41/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/103/ : SUCCESS

-------------------------------------
author: Emerson Nolan
date: 2016-03-10 17:18:38.155000000

Patch Set 1:

@DaveR yes the test case fails without the fix.

-------------------------------------
author: Tate Garrett
date: 2016-03-10 18:06:55.555000000

Change has been successfully cherry-picked as bb1138b7fb903f40a605e8af48873937c56f0e06

-------------------------------------
