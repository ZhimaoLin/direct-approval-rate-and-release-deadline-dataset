DESCRIPTION

MB-20623: Remove 'fetches' vector from MutationLogHarvester::apply

MutationLogHarvester::apply() builds a vector of keys (`fetches`) to
fetch from disk. This is essentially identical to the contents of
`committed`, except it only contains keys which currently exist in the
VBucket.

We can optimize this by removing fetches, and instead erasing the
elements from `committed[vb]` which are no longer valid. This also
means we no longer have to check for duplicates in batchWarmupCallback
(which was kinda pointless even before), as the data structure passed
in is now a set (and hence cannot by definition contain dupes).

Results in a reduction in the memory used by these temporary warmup
data structures - from 3876MB to 3218MB (17%) for the following
workload:

* 1 bucket, 10,000MB quota, 1 node.
* 30M items, 300bytes each. Dataset generated by:
    cbc-pillowfight -U Piper Jefferson://localhost:12000 -I 30000000 -m 300 -M 300 -t16

Change-Id: I1c2e480e53626be41fa20dcd44abe4d6fa327e4c


COMMENTS

author: Ashlee Kent
date: 2016-09-29 09:25:41.829000000

Uploaded patch set 5: Patch Set 4 was rebased.

-------------------------------------
author: Hugo Blankenship
date: 2016-09-29 09:25:51.621000000

Patch Set 5:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1319/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-29 09:50:39.200000000

Patch Set 5:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/995/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-29 09:54:19.063000000

Patch Set 5:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1167/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-29 10:26:03.872000000

Patch Set 5: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1319/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/995/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1167/ : SUCCESS

-------------------------------------
author: Kymani Ramirez
date: 2016-09-30 09:02:11.939000000

Patch Set 5: Code-Review+2

-------------------------------------
author: Ashlee Kent
date: 2016-09-30 13:30:17.761000000

Patch Set 6: Patch Set 5 was rebased

-------------------------------------
author: Tate Garrett
date: 2016-09-30 15:07:05.715000000

Change has been successfully cherry-picked as fa74b8dce7632236799192d1810c82b539e1949b by Ashlee Kent

-------------------------------------
