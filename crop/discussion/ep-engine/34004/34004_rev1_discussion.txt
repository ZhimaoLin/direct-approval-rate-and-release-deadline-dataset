DESCRIPTION

MB-10259 Check for NULL object when parsing vbstat json doc

Log a warning if cJSON returns NULL when parsing vbstat json doc

Change-Id: I6a7276ba3a5aaa49547758386f78db5a09990539


COMMENTS

author: Miley Adams
date: 2014-02-27 23:48:50.842000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2014-02-28 00:42:07.343000000

Patch Set 1: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-300/182/ : SUCCESS

-------------------------------------
author: Kenny Maynard
date: 2014-02-28 01:02:30.460000000

Patch Set 1: Code-Review-1

(1 comment)

Line:1827, src/couch-kvstore/couch-kvstore.cc -> I don't think that the issue is that the json is parsed incorrectly. I think the issue is that the json is written incorrectly to disk. This may cause other issues. For example, if we merge this code then the checkpoint id and vbucket state may not be set properly.

I would recommend putting an assert in saveVBState to check to see if the json for the failover log is valid. When it crashes you can then get a stack trace to see how the issue occurred.

-------------------------------------
author: Miley Adams
date: 2014-03-04 20:20:41.582000000

Patch Set 1:

(1 comment)

Line:1827, src/couch-kvstore/couch-kvstore.cc -> If there is saveVBState issue, we should fix separately.
This check is still needed because even if saveVBState works ok, the in-memeory buffer can get corrupted and this helps to detect that. We can not depend on the component uses cJSON correctly or CJSON may has bugs.

At least with this check many tests can continue without blocking.

-------------------------------------
author: Kenny Maynard
date: 2014-03-04 21:47:58.468000000

Patch Set 1: -Code-Review

-------------------------------------
author: Miley Adams
date: 2014-03-05 08:34:16.128000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Tate Garrett
date: 2014-03-05 08:34:19.306000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Miley Adams
date: 2014-03-05 08:34:36.195000000

Patch Set 2: Patch Set 1 was rebased

-------------------------------------
