DESCRIPTION

MB-16915: Change stream_t to be an RCPtr

Many threads are using the stream_t so there's a risk
that concurrent access resulted in premature deletion
of the value.

Change-Id: I32a7dfd10daa4565b9cbb4c8142ed8f71c13ca31


COMMENTS

author: Jim WNathalie Landryer
date: 2015-11-28 17:42:02.491000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2015-11-28 17:42:10.093000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/246/

-------------------------------------
author: Jim WNathalie Landryer
date: 2015-11-28 17:42:36.534000000

Patch Set 1:

This might be needed

-------------------------------------
author: Hugo Blankenship
date: 2015-11-28 17:56:34.025000000

Patch Set 1: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/246/ : SUCCESS

-------------------------------------
author: Abby Duran
date: 2015-11-30 02:42:46.489000000

Patch Set 1: Code-Review-1

Jim,

As you mentioned in the CBSE ticket, this fix won't resolve the memory corruption issue.

The main root cause is that the DCP producer object gets freed from memory, but the DCP backfill task spawned by the producer's stream instance still tries to access the name (std::string) variable of the producer.

To fix this issue,  each stream instance should refer to its parent producer instance through a smart pointer instead of a raw reference. In this way, the producer object won't be freed until all of its stream instances get closed and freed from memory.

-------------------------------------
author: Tate Garrett
date: 2015-12-01 19:16:01.510000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Tate Garrett
date: 2015-12-02 00:08:22.763000000

Change has been successfully cherry-picked as 7110b3eb1df48ac446791ea222292858f4019c16

-------------------------------------
