DESCRIPTION

MB-16875: Snapshot vb task to persist vbucket state only if necessary

The snapshot vbucket task should persist vbucket state only if
it detects a change only in necessary parameters, as it used to
previously.

Change-Id: I7c6d1ef67d6936cdc724f849bfb7c057bb4487c5


COMMENTS

author: Emerson Nolan
date: 2015-12-04 17:54:25.677000000

Uploaded patch set 6.

-------------------------------------
author: Hugo Blankenship
date: 2015-12-04 17:54:35.278000000

Patch Set 6:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1708/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2015-12-04 18:48:08.007000000

Patch Set 6: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1708/ : ABORTED

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/951/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2015-12-04 18:48:15.018000000

Patch Set 6: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1709/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2015-12-04 18:56:01.121000000

Patch Set 6: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/951/ : SUCCESS

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1709/ : SUCCESS

-------------------------------------
author: Abby Duran
date: 2015-12-05 00:53:19.394000000

Patch Set 6:

(2 comments)

Line:162, src/kvstore.h -> only if

Line:84, src/kvstore.cc -> If no changes are detected, then we can return immediately right?

-------------------------------------
author: Emerson Nolan
date: 2015-12-05 00:59:29.508000000

Patch Set 6:

(1 comment)

Line:84, src/kvstore.cc -> This is essentially only for snapshotVBucket task, this task would need to persist only if changes are seen in state and failovers.

Note that this function (updateCachedVBState) will be invoked by flushVBucket too to update the cachedVBState, reason why we would still need to update other properties that are part of the cachedVBstate before returning.

-------------------------------------
author: Tate Garrett
date: 2015-12-05 01:50:30.027000000

Change has been successfully cherry-picked as bef6f790f9b4537f8e49e7198d78a14f94a15d5f

-------------------------------------
