DESCRIPTION

MB-14190: Use custom sequence numbers to store items in ForestDB

Use the sequence number from the item in order to save it to ForestDB.
Also don't optimize writes for ForestDB as the current optimization
for couchstore breaks the sequence number ordering that ForestDB
enforces.

Change-Id: Ic178edc9f9100d5b4368d77505f7075295b2629b


COMMENTS

author: Hugo Blankenship
date: 2015-07-07 02:36:42.118000000

Patch Set 6:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/394/

-------------------------------------
author: Hugo Blankenship
date: 2015-07-07 02:43:44.105000000

Patch Set 6: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/394/ : SUCCESS

-------------------------------------
author: Abby Duran
date: 2015-07-07 03:15:37.373000000

Patch Set 6: Code-Review-1

(1 comment)

Line:512, src/kvstore.h -> Sorting keys and then their seq numbers will also improve the write performance in ForestDB.

i'm not sure why we can't use this optimization.

-------------------------------------
author: Bobby Buck
date: 2015-07-07 03:24:54.239000000

Patch Set 6:

(1 comment)

Line:512, src/kvstore.h -> Example: key: pymc348 seq: 3, key: pymc9 seq: 1. Optimizing these writes would make pymc348 written first and pymc9 next. fob_set of pymc9 would result in an error as a higher sequence number has already been written. This is the current implementation. If it is not a big deal to relax the restriction in ForestDB, we can do this optimization.

-------------------------------------
author: Abby Duran
date: 2015-07-07 05:26:44.089000000

Patch Set 6:

(1 comment)

Line:512, src/kvstore.h -> Sundar,

I think we can relax this restriction inside ForestDB if the seq number is generated by the application side.

-------------------------------------
author: Bobby Buck
date: 2015-07-07 14:58:09.529000000

Patch Set 6:

(1 comment)

Line:512, src/kvstore.h -> Before Sundar could relax the restriction, it could be nice to know as to how the sorting helps the performance for ForestDB. My understanding is that both the keys are inserted into the WAL (hash table) and a WAL flush would just update both the keys to the Trie. But I could be wrong.

-------------------------------------
author: Bobby Buck
date: 2015-07-07 18:20:49.263000000

Patch Set 6:

(1 comment)

Line:512, src/kvstore.h -> Never mind. Sundar filled me on the details.

-------------------------------------
author: Tate Garrett
date: 2015-07-08 01:35:19.552000000

Change has been successfully cherry-picked as fdb85cd3062b0615a14a2fab925d3e21391eb6bd

-------------------------------------
