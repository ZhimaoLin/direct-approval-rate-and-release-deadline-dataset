DESCRIPTION

MB-16357: Interlock expiry and vbucket state changes

Expiry should only occur whilst the vbucket is active.
Background tasks performing expiry deletion must stop
driving deletions when the vb changes status to !active.

Using a reader/writer lock the core deleteExpiredItem
function which is used by both compaction driven expiry
and the item pager are now interlocked with vbucket::setState()

Change-Id: I19d30c3d7855778613ccb4534a042c0daf627b8c


COMMENTS

author: Jim WNathalie Landryer
date: 2015-10-02 12:42:18.783000000

Uploaded patch set 3.

-------------------------------------
author: Hugo Blankenship
date: 2015-10-02 12:42:26.772000000

Patch Set 3:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/335/

-------------------------------------
author: Hugo Blankenship
date: 2015-10-02 12:44:10.131000000

Patch Set 3: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/335/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2015-10-09 10:28:52.739000000

Patch Set 3: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/338/

-------------------------------------
author: Hugo Blankenship
date: 2015-10-09 10:33:31.291000000

Patch Set 3: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/338/ : FAILURE

-------------------------------------
author: Jim WNathalie Landryer
date: 2015-10-09 10:38:37.810000000

Abandoned

merged up from 3x

-------------------------------------
