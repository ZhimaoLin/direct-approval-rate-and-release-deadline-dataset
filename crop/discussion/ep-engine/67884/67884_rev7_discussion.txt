DESCRIPTION

MB-20869: Simplify test to fix intermittent test_access_scanner failure

In test_access_scanner the check that the number of non-resident items
was less than 6% of the total is incorrect - it was using integer
division (6/100) and hence the RHS of the check was always zero, which
would always succeed. Fix the check so it calculates the percentage
correctly.

Additionally we did not wait for the previous AccessScanner run to
finalize - which meant that the second start of the access acanner
could fail to start (and consequently we would timeout with the
message:

    Exceeded maximum wait time of 60000000us waiting for stat
    'ep_num_access_scanner_runs' to be greater or equal than 8 -
    aborting.

To solve this, change to just one iteration of creating the file (not
sure why it did two before), and move the increment of stats.alogRuns
to /after/ the access log files are renamed.

Change-Id: I6c3b6eeed91302fd7fa67dfade6ae954078fc125


COMMENTS

author: Ashlee Kent
date: 2016-09-28 15:42:35.190000000

Patch Set 7: Published edit on patch set 6

-------------------------------------
author: Hugo Blankenship
date: 2016-09-28 15:42:41.222000000

Patch Set 7:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1300/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-28 16:15:38.029000000

Patch Set 7:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/984/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-28 16:21:20.140000000

Patch Set 7:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1155/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-09-28 16:32:34.358000000

Patch Set 7: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1300/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1155/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/1155/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/984/ : SUCCESS

-------------------------------------
author: Adrianna Holmes
date: 2016-09-28 18:32:13.017000000

Patch Set 7:

We have a failure now
Exceeded maximum wait time of 60000000us waiting for stat 'ep_num_access_scanner_runs' to be 4 (last value:1) - aborting.

This seems like a sure failure, reproducible on a local PC

-------------------------------------
author: Tate Garrett
date: 2016-09-29 12:07:14.220000000

Change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Tate Garrett
date: 2016-09-29 12:36:57.094000000

Change has been successfully cherry-picked as 63edc3b6483e9740db142e483515bd078dc56555 by Ashlee Kent

-------------------------------------
