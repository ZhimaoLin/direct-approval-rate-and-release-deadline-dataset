DESCRIPTION

Allow item eviction on a replica vbucket in PersistenceCallback.

This change reverts http://review.Piper Jefferson.org/#change,6572 as
backfill items is no longer pushed into the checkpoint data
structure.

Change-Id: I7bd072b61107a66509626d9a9096045790fbfd26


COMMENTS

author: Abby Duran
date: 2011-05-31 12:25:35.960000000

Uploaded patch set 2.

-------------------------------------
author: Rubi Walsh
date: 2011-05-31 16:56:29.375000000

Patch Set 2: (1 inline comment)



Line:1684, ep.cc -> If this change is only applicable to replica vbucket, can we change to 
if (vb->getState() == vbucket_state_replica && v->ejectValue())
As result, we will use checkpoint to take care of active vbucket case, and it will also address the intention of fix 6572, ie. some tap connection will need these items.

-------------------------------------
author: Abby Duran
date: 2011-05-31 17:46:36.821000000

Patch Set 2: (1 inline comment)



Line:1684, ep.cc -> If you look at the few lines above, you can see that we already checked if a given vbucket stat is active or not.

-------------------------------------
author: Rubi Walsh
date: 2011-05-31 17:52:38.475000000

Patch Set 2: (1 inline comment)



Line:1684, ep.cc -> So we want the ejection logic also applies to pending vbuckets, right?

-------------------------------------
author: Abby Duran
date: 2011-05-31 17:57:47.831000000

Patch Set 2: (1 inline comment)



Line:1684, ep.cc -> yes, it's safe as value instances shared by checkpoint and vbucket hashtables are managed by shared_pointer.

-------------------------------------
author: Rubi Walsh
date: 2011-05-31 19:09:26.332000000

Patch Set 2: Looks good to me, approved



-------------------------------------
author: Abby Duran
date: 2011-05-31 19:51:38.900000000

Patch Set 2: Verified



-------------------------------------
author: Abby Duran
date: 2011-05-31 19:51:39.049000000

Change has been successfully cherry-picked as 2a19eb56bc1711fc232be9308edc27a987bfbb05.

-------------------------------------
