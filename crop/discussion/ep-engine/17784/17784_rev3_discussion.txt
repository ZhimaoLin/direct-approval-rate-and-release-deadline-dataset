DESCRIPTION

MB-5746: Fix set with meta test case

When you set the expiration time of an item and the exptime is below
30 days then we set the expiration to that time relative to the current
time. Anything over 30 days is considered absolute time after the epoch.
Item meta data created in a test case doesn't do through the conversion for
values under 30 days. As a result the time here was being set to 5 minutes
after the epoch.

This is a problem for test cases because the item will expire if it is
accessed after being set and will throw off tests that aren't expecting
the item to expire.

In one of the tests there were two set with meta operations. If the
sequence was set-expire-set then the cas value would be one higher
than if the sequence was set-set-(expire on next call).

This change also adds logic to convert a relative expiration time
to its absolute time in the setWithMeta and delWithMeta funcitons.

Change-Id: I24550ac8a866d3bf6cf7549335d92e0e06bf36e7


COMMENTS

author: Kenny Maynard
date: 2012-07-05 18:37:03.794000000

Uploaded patch set 3.

-------------------------------------
author: Macie Morton
date: 2012-07-05 19:53:35.325000000

Patch Set 3: (1 inline comment)



Line:6523, ep_testsuite.cc -> My understanding is the exptime read back from metadata is in converted form (absolute time since epoch). 

But does that mean we are unable to verify the exptime any more? 

Yes we can time travel 301 seconds to verify it has  expired but it does not necessarily mean the exptime is correctly converted.

-------------------------------------
author: Kenny Maynard
date: 2012-07-05 20:04:20.311000000

Patch Set 3: (1 inline comment)



Line:6523, ep_testsuite.cc -> I discussed this with Junyi. If anyone would like me to add anything more specific to check the expiration time then please let me know.

-------------------------------------
author: Macie Morton
date: 2012-07-05 20:13:06.004000000

Patch Set 3: Looks good to me, but someone else must approve



-------------------------------------
author: Abby Duran
date: 2012-07-05 20:13:09.900000000

Patch Set 3: Verified; Looks good to me, approved



-------------------------------------
author: Tate Garrett
date: 2012-07-05 20:13:11.092000000

Your change could not be merged due to a path conflict.

Please merge (or rebase) the change locally and upload the resolution for review.

-------------------------------------
