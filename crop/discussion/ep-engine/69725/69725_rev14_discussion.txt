DESCRIPTION

MB-21568: Reconcile hashtable with disk following rollback

After rolling back the disk store to the requested seqno a scan of the
vbucket's checkpoint must occur. Any item in the checkpoint with
a seqno > than the rollback must be dropped or rolled back.

+ A missing close is addressed by using a wrapper class that will
  RAII close each file opened in the rollback code.

Change-Id: Iabe43f59ed40931c1c97b65147b7a414d4ff7cc5


COMMENTS

author: Tate Garrett
date: 2016-11-14 10:18:55.152000000

Change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Jim WNathalie Landryer
date: 2016-11-16 12:52:48.900000000

Uploaded patch set 14.

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 12:52:58.094000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1580/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 12:52:58.236000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/404/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 12:52:58.379000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1374/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 12:52:58.534000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1789/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 13:25:47.085000000

Patch Set 14: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1789/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/404/ : FAILURE

Timeout of a CTest test 27/27 Test #20: ep-engine_full_eviction_dcp ...........} ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-watson/404/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1374/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1580/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:17:07.025000000

Patch Set 14: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/405/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:24:05.229000000

Patch Set 14: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1789/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/405/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-watson/405/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1374/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1580/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:53:31.684000000

Patch Set 14: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/407/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:53:31.836000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1376/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:53:31.993000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1791/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 14:53:32.152000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1582/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 15:27:04.558000000

Patch Set 14: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/407/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-watson/407/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1376/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1791/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1582/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 15:32:08.904000000

Patch Set 14: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1792/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 15:40:30.836000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/408/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 15:42:31.689000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1377/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 15:44:34.646000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1583/ (4/4)

-------------------------------------
author: Ashlee Kent
date: 2016-11-16 16:20:37.252000000

Patch Set 14: Code-Review+2

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:23:34.152000000

Patch Set 14: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1792/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/408/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1377/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1583/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:27:24.237000000

Patch Set 14: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1793/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:29:41.829000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/409/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:29:45.254000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1378/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:30:00.205000000

Patch Set 14:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1584/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-11-16 16:44:13.714000000

Patch Set 14: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1793/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/409/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1378/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1584/ : SUCCESS

-------------------------------------
author: Tate Garrett
date: 2016-11-16 16:57:14.775000000

Change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Ashlee Kent
date: 2016-11-16 16:57:23.245000000

Patch Set 15: Patch Set 14 was rebased

-------------------------------------
author: Tate Garrett
date: 2016-11-16 18:02:44.693000000

Change has been successfully cherry-picked as b20aeb6170dd9092e97c5e9346125747f3312a39 by Ashlee Kent

-------------------------------------
