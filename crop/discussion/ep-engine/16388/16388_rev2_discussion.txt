DESCRIPTION

MB-5373 Skip adding non-vbucket file to CouchKVStore's internal file map

Non-vbucket files like master.couch should not be hashed
into CouchKVStore's internal dbFileMap. This could cause
incorrect file mapping based on invalid conversion of
non-numeric string to wrong vbucket id during warmup.

Change-Id: I7ed224c7caace233961a1e8e7c01dd3dd7d415f7


COMMENTS

author: Audrina Olson
date: 2012-05-25 00:14:31.883000000

Uploaded patch set 2.

-------------------------------------
author: Roman Murillo
date: 2012-05-25 00:22:19.751000000

Patch Set 2: Looks good to me, approved



-------------------------------------
author: Abby Duran
date: 2012-05-25 01:22:54.753000000

Patch Set 2: I would prefer that you didn't submit this

(1 inline comment)



Line:1058, couch-kvstore/couch-kvstore.cc -> This will be always true.

-------------------------------------
author: Audrina Olson
date: 2012-05-25 06:58:48.390000000

Patch Set 2: (1 inline comment)



Line:1058, couch-kvstore/couch-kvstore.cc -> I know this code isn't really comprehensive. According to the std::stringstream dictionary, >> or << operator returns the object itself when the conversion succeeds. And, I Adrianna Holmesally tested the following code does work in case of non-vbucket database file.

-------------------------------------
author: Audrina Olson
date: 2012-05-25 07:06:44.857000000

Patch Set 2: (1 inline comment)



Line:1058, couch-kvstore/couch-kvstore.cc -> Please disregard the above comment - does not make sense. Basically, bool(ss) is equivalent to !ss.fail() according to the std::stringstream dictionary.

-------------------------------------
