DESCRIPTION

Implement vbucket snapshot for ForestKVStore

Change-Id: Ifdc3729c74dfe0f92f086111ec5af92aee1ff811


COMMENTS

author: Hugo Blankenship
date: 2015-09-14 18:10:48.661000000

Patch Set 2:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/954/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-14 18:38:59.574000000

Patch Set 2: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/954/ : FAILURE

-------------------------------------
author: Abby Duran
date: 2015-09-14 21:57:50.954000000

Patch Set 2: Code-Review-1

(2 comments)

Line:906, src/couch-kvstore/couch-kvstore.cc -> Then, this function should be removed from couch-kvstore.h

Line:751, src/forest-kvstore/forest-kvstore.cc -> Where is 'vbstate' variable used in this function?

-------------------------------------
author: Jim WNathalie Landryer
date: 2015-09-15 12:51:56.089000000

Patch Set 2: Code-Review-1

(2 comments)

Line:75, src/kvstore.cc -> we should just return false (and maybe log that fact) instead of aborting memcached.

Line:90, src/kvstore.cc -> Where is this new data deleted?

-------------------------------------
author: Bobby Buck
date: 2015-09-15 17:44:44.589000000

Patch Set 2:

(1 comment)

Line:90, src/kvstore.cc -> In the respective destructor

-------------------------------------
author: Jim WNathalie Landryer
date: 2015-09-16 08:43:02.166000000

Patch Set 2:

(1 comment)

Line:90, src/kvstore.cc -> Ok, I see it, not for this patch but that's not great to have the parent class allocate and expect sub-classes to delete, certainly confused me :)  For future we should make use of unique_ptr (cachedVBStates would be a vector of unique_ptr) to get deletion for "free"

-------------------------------------
author: Bobby Buck
date: 2015-09-16 17:32:10.364000000

Patch Set 2:

(1 comment)

Line:90, src/kvstore.cc -> Sure. I shall consider that in one of the follow up patches.

-------------------------------------
author: Bobby Buck
date: 2015-09-16 17:37:51.469000000

Patch Set 2:

(1 comment)

Line:751, src/forest-kvstore/forest-kvstore.cc -> True. It isn't used here. I thought abstracting out setVBucketState would keep snapshotVbucket simpler. But doesn't look like it is. There is no end to the joys of refactoring in the KVStore layer :).

-------------------------------------
author: Bobby Buck
date: 2015-09-17 21:38:11.450000000

Patch Set 2:

(2 comments)

Line:906, src/couch-kvstore/couch-kvstore.cc -> Done

Line:751, src/forest-kvstore/forest-kvstore.cc -> Done

-------------------------------------
author: Tate Garrett
date: 2015-09-23 02:41:47.151000000

Change has been successfully cherry-picked as 18aaaa38c43f47d7e96824a85ef55473d440cbb7

-------------------------------------
