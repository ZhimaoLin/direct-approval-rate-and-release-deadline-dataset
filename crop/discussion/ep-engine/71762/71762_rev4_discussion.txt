DESCRIPTION

MB-22241: Only check opaque validity for stream request responses

The response handler attempts to find the opaque in the opaque map for
all responses. However it should only do this for stream request
responses.

If it could not find the opaque in the map it prints a message stating
"Received response with opaque [x] and that stream no longer exists".
See below for an example, where the responses related to control
messages.

2017-01-10T07:20:42.972817Z NOTICE (default) DCP (Consumer) xxx@xxx.xxx - (vb 1023) Attempting to add  stream with start seqno 0, end seqno 18446744073709551615, vbucket uuid 107579528815810, snap start seqno 0, snap end seqno 0, and vb_high_seqno 0
2017-01-10T07:20:42.974227Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 2 and that stream no longer exists
2017-01-10T07:20:42.975006Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 3 and that stream no longer exists
2017-01-10T07:20:42.975481Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 4 and that stream no longer exists
2017-01-10T07:20:42.976090Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 5 and that stream no longer exists
2017-01-10T07:20:42.976710Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 6 and that stream no longer exists
2017-01-10T07:20:42.976943Z WARNING (default) DCP (Consumer) xxx@xxx.xxx - Received response with opaque 7 and that stream no longer exists

This patch changes the code to only attempt to find the opaque in the
opaque map for stream request responses.  For stream request responses
if an entry cannot be found in the map then a WARNING message is
logged.

If an opaque is found then a subsequent check is made to see if the
opaque held in the map is valid.  If it is not valid a different
WARNING message is logged.

Change-Id: Iee23a7ac0d3dd8455e0462b7b851be3f78601e72


COMMENTS

author: Kymani Ramirez
date: 2017-01-10 15:40:17.810000000

Uploaded patch set 4.

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 15:40:23.791000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2775/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 15:40:23.925000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2261/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 15:40:24.052000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1449/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 15:40:24.174000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2620/ (4/4)

-------------------------------------
author: Ashlee Kent
date: 2017-01-10 15:41:55.227000000

Patch Set 4: Code-Review+2

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 15:55:44.703000000

Patch Set 4: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2775/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2620/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2261/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1449/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 16:00:12.920000000

Patch Set 4: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2776/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-10 16:14:28.404000000

Patch Set 4: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2620/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2261/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1449/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/2776/ : SUCCESS

-------------------------------------
author: Tate Garrett
date: 2017-01-10 18:37:38.313000000

Change has been successfully cherry-picked as 8675dcb7e71bf135eb1541ac5467b19a00adc11a by Ashlee Kent

-------------------------------------
