DESCRIPTION

MB-22123 - improve DCP rollback log message

Change-Id: Idd171840076fc4d6cf95a71232a865edb58efc31


COMMENTS

author: Jace Townsend
date: 2017-01-19 14:35:30.697000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:35:37.848000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2891/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:35:37.975000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1720/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:35:38.121000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/3051/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:35:38.247000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2519/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:45:23.425000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/3051/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2891/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2519/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1720/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 14:53:10.945000000

Patch Set 1: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/3052/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2017-01-19 15:11:54.426000000

Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/2891/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/2519/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/1720/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/3052/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2017-01-19 16:07:22.992000000

Patch Set 1: Code-Review-1

(4 comments)

Generally looks good, but I expect that you might be able to get even nicer error messages :)

If you haven't already, probably worth running the unit tests with debug enabled (run ./ep-engine_ep_unit_tests with `-v`) and examing exactly what they look like when expanded.

Line:268, src/dcp/producer.cc -> Style: This is arguably a good use for auto - you don't need to specify a (somewhat lengthy) type, just let the compiler handle it.

Line:142, src/failover-table.cc -> It would be nice to be super explicit for the user, and include the actual values of the variables inline in the messages - e g.:

 "snap_start seqno (1000) is less than purge_seqno (2000) - items may 
  have been deleted..."

Line:167, src/failover-table.cc -> Given your description says that a message is only returned if the function returns true, probably simpler to just return an empty string here.

Line:178, src/failover-table.cc -> Similar here, useful to include the point where they diverged (i.e. rollback seqno) in the message.

-------------------------------------
author: Tate Garrett
date: 2017-01-25 17:13:03.848000000

Change has been successfully cherry-picked as 0a81d315bd13d3c8f99354abcc72a817559b984d by Ashlee Kent

-------------------------------------
