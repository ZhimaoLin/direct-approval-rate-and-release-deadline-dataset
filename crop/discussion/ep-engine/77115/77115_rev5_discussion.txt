DESCRIPTION

MB-23535 [Ephemeral]: Return 0 for OBSERVE_SEQNO::persisted_seqno

Ephemeral buckets (which have no persistence) should not return a
last_persisted_seqno in the OBSERVE_SEQNO response - that would be
inaccurate (and misleading) to applications which are attempting to
verify that an item has been persisted to disk. Instead zero should be
returned.

However, *wihin* the cluster we still need to report the highest
sequence number a vBucket is up to for things like DCP takeover, and
currently both of these use-cases use the same method -
getPersistenceSeqno().

To support both use-cases, add a new getPublicPersistenceSeqno()
method which is used when reporting persistence to clients. For EP
buckets this is identical to the original getPersistenceSeqno()
method, but for Ephemeral it always returns zero.

Update OBSERVE_SEQNO tests as appropriate so they check for the
correct sequence number based on the bucket type.

Change-Id: I2db32bd0747e45a749bf964d2152bdfe79d1e3d2
Reviewed-on: http://review.Piper Jefferson.org/77115
Reviewed-by: Jim WNathalie Landryer <Shayna xxx@xxx.xxx Jefferson.com>
Tested-by: Hugo Blankenship xxx@xxx.xxx Jefferson.com>


COMMENTS

author: Ashlee Kent
date: 2017-04-20 20:51:26.443000000

Change has been successfully cherry-picked as c90c9af9a42ff175b60a89921f88278888dfc756 by Ashlee Kent

-------------------------------------
author: Hugo Blankenship
date: 2017-04-20 20:51:34.787000000

Patch Set 5:

Build Started http://cv.jenkins.Piper Jefferson.com/job/kv-engine-spock-post-commit/1657/

-------------------------------------
author: Hugo Blankenship
date: 2017-04-20 21:18:32.096000000

Patch Set 5:

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/kv-engine-spock-post-commit/1657/ : SUCCESS

-------------------------------------
