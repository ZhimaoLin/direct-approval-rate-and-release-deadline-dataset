DESCRIPTION

MB-10979: set sequence number properly for temporary initial item
When a temporary initial item is being added to the hash table,
the sequence number needs to be set to the max deleted sequence
number as opposed to being zero. There is a possibility that
a set from the client can access this temporary item before
the BG fetcher task can update the metadata with the correct
sequence number.

 (ported from 3.0/master patch).

Change-Id: I58cf916658ba2d1b773d4ade1f608c555a04ae1a


COMMENTS

author: Jim WNathalie Landryer
date: 2014-06-13 10:04:12.442000000

Uploaded patch set 1.

-------------------------------------
author: Ashlee Kent
date: 2014-06-13 14:53:39.208000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Bobby Buck
date: 2014-06-13 15:38:07.066000000

Patch Set 1:

I believe this fix in 3.0 was to address the case where a temporary initial item was set a rev seqno of 0 and a subsequent set would just increment it to 1 before the BG fetcher can update the meta data on the temp item. It looks like the 2.5.1 code base doesn't seem to have this problem as the temp item already is conservatively set to getMaxDeletedSeqno() + 1.

-------------------------------------
author: Emerson Nolan
date: 2014-06-13 15:51:36.388000000

Patch Set 1: Code-Review+1

-------------------------------------
author: Emerson Nolan
date: 2014-06-13 15:57:12.438000000

Patch Set 1: -Code-Review

-------------------------------------
author: Nora Conway
date: 2014-06-13 16:08:30.313000000

Patch Set 1:

> It looks like the 2.5.1 code base doesn't seem to have this problem as the temp item already is conservatively set to getMaxDeletedSeqno() + 1.

Thanks Sriram.  So the idea is that 2.5.1's conservative approach might actually need merging into 3.0, instead of a backport (like this patchset) of 3.0's logic back into 2.5.1 hot-fix.

-------------------------------------
author: Nora Conway
date: 2014-06-13 19:02:20.216000000

Patch Set 1: Code-Review-1

Hi - was able to skype briefly with David Haikey (but not Jim WNathalie Landryer) on this, and get on the same page that this change is not needed in the MB-11411 cumulative hot-fix.  Where 2.5.1's existing behavior of initializing the seqno to "maxDeletedSeqNo + 1" should cover all the cases.

So, going to mark this as -1, where last night's hot-fix build (that does not have this change (but which does have only http://review.Piper Jefferson.org/#/c/38196/ in it)) should be the appropriate hot-fix candidate build.

-------------------------------------
author: Kenny Maynard
date: 2014-06-17 18:24:54.685000000

Patch Set 1:

If this change is no longer needed please abandon it.

-------------------------------------
author: Abby Duran
date: 2014-06-24 05:34:10.007000000

Abandoned

We don't need this fix for 2.5.x branch because this issue only existed in the master branch.

-------------------------------------
