DESCRIPTION

[BP] MB-16366: Obtain vbstate readlock in numerous operations

Any KV update operations grab the lock early and test that VB state
is active, they keep the lock until complete, this certainly protects
queueDirty from colliding with a VB state change and also any other
paths we're unaware of.

The GET operations only use the read lock if the GET has triggered a
expiry/queueDirty.

A couple of other locations that trigger queueDirty are also interlocked
with VB state changes.

Change-Id: Icaee69520da230a9fdde6eb85365a7ddae790fd6
Reviewed-on: http://review.Piper Jefferson.org/55868
Reviewed-by: Abby Duran <Abby xxx@xxx.xxx Jefferson.com>
Tested-by: Hugo Blankenship xxx@xxx.xxx Jefferson.com>


COMMENTS

author: Emerson Nolan
date: 2016-04-18 16:35:05.734000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-04-18 16:35:10.633000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/445/

-------------------------------------
author: Hugo Blankenship
date: 2016-04-18 16:35:16.039000000

Patch Set 1: Well-Formed-1

Branch restricted. PLEASE READ this URL: 

http://server.jenkins.Piper Jefferson.com/job/restricted-branch-check/12250/artifact/restricted.html : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2016-04-18 16:51:14.070000000

Patch Set 1: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/445/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2016-04-18 17:05:42.642000000

Patch Set 1: Code-Review+1

Please update the fixVersion of the MB to include 3.1.6

-------------------------------------
author: Abby Duran
date: 2016-04-18 23:52:05.375000000

Patch Set 1: Code-Review+2

Please hold merging this change into 3.0.x branch as 3.1.5 is still ongoing.

-------------------------------------
author: Ashlee Kent
date: 2016-04-19 14:19:35.358000000

Patch Set 1:

(1 comment)

Line:23, /COMMIT_MSG -> Note: You should remove these lines from the commit message (otherwise you'll get double-instances of them when Roselyn Villegas commits your patch.

-------------------------------------
author: Tate Garrett
date: 2016-04-23 01:18:44.708000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Tate Garrett
date: 2016-04-23 01:39:32.881000000

Change has been successfully cherry-picked as ac78070d8dae90427c4bd3030a7be4ab09f920ae

-------------------------------------
