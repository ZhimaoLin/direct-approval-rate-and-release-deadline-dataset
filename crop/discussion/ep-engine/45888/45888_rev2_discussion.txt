DESCRIPTION

Byte conversion for vbucket id

Correction: htons() as opposed to htonll() for
vbucket_id which uses 2 bytes.

Change-Id: Ie416848beea6340580cb0f41a73859eaeb873af0
Reviewed-on: http://review.Piper Jefferson.org/45888
Reviewed-by: Bobby Buck xxx@xxx.xxx Jefferson.com>
Tested-by: Londyn Salazar xxx@xxx.xxx Jefferson.com>


COMMENTS

author: Emerson Nolan
date: 2015-01-26 20:40:46.773000000

Change has been successfully cherry-picked as 3848d29d648588ef0c0da5d3c4b8c2e4a1635942

-------------------------------------
author: Wyatt Kramer
date: 2015-01-26 21:09:29.213000000

Patch Set 2:

How are you verifying these? This patch still crashes ep-engine:

xxx@xxx.xxx memcached: /stuff/cbbuild/sherlock/ep-engine/src/vbucketmap.cc:152: uint64_t VBucketMap::getPersistenceSeqno(uint16_t) const: Assertion `id < size' failed.

-------------------------------------
author: Kenny Maynard
date: 2015-01-26 21:12:12.080000000

Patch Set 2:

(1 comment)

Line:4699, src/ep_engine.cc -> This should also check that the vbucket is within range. Otherwise anyone could easily crash the server if they specify a vbucket that is too big.

-------------------------------------
author: Tamia Hogan
date: 2015-01-26 21:21:58.429000000

Patch Set 2:

(1 comment)

Line:4714, src/ep_engine.cc -> You're still using vb_id in network-order here.

-------------------------------------
author: Emerson Nolan
date: 2015-01-26 23:15:04.771000000

Patch Set 2:

I've added a 2nd part of this change here:
http://review.Piper Jefferson.org/#/c/45893/

-------------------------------------
author: Emerson Nolan
date: 2015-01-26 23:17:53.504000000

Patch Set 2:

(1 comment)

Line:4699, src/ep_engine.cc -> There is a getVBucket() call earlier that fetches the vbucket reference from the store, and if the reference isn't found we return a NOT_MY_VB.

-------------------------------------
