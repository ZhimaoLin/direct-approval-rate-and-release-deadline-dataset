DESCRIPTION

Refactor getLockedBucket to remove int ptr

getLockedBucket returned a lock and alter the int passed via a pointer.
This commit combines the two in to a structure that is returned. Part of
the motivation of this was that the bucketNum should not be nullable.

Change-Id: I78a3752e10d8aadd965f88d501eef3ff947d9243


COMMENTS

author: Aaliyah Proctor
date: 2017-02-23 09:00:11.693000000

Uploaded patch set 4.

-------------------------------------
author: Hugo Blankenship
date: 2017-02-23 09:13:48.626000000

Patch Set 4: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/2749/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/3512/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3922/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/4123/ : SUCCESS

-------------------------------------
author: Jim WNathalie Landryer
date: 2017-02-23 14:09:41.600000000

Patch Set 4: Code-Review-1

(7 comments)

Looking good, just a few minor things lost in the refactor

Line:1121, src/vbucket.cc -> we've lost the allowExisting and hasMetaData comments, please restore.

Line:1190, src/vbucket.cc -> same here, comments have been lost

Line:1649, src/vbucket.cc -> comments have been lost, please add back

Line:1797, src/vbucket.cc -> lost the comment

Line:1850, src/vbucket.cc -> same, add comment back

Line:127, src/hash_table.h -> can you update the comment to state this provides RAII semantics for the lock. I.e. will unlock when object is discarded

Line:148, src/hash_table.h -> we normally put the const first, so 

  const std::unique_lock<std::mutex>& getHTLock() const {

-------------------------------------
