DESCRIPTION

Refactor getLockedBucket to remove int ptr

getLockedBucket returned a lock and alter the int passed via a pointer.
This commit combines the two in to a structure that is returned. Part of
the motivation of this was that the bucketNum should not be nullable.

Change-Id: I78a3752e10d8aadd965f88d501eef3ff947d9243


COMMENTS

author: Aaliyah Proctor
date: 2017-02-21 10:14:58.700000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2017-02-21 10:28:21.357000000

Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/2689/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/3457/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3860/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/4074/ : SUCCESS

-------------------------------------
author: Jim WNathalie Landryer
date: 2017-02-21 13:37:23.795000000

Patch Set 1: Code-Review-1

(5 comments)

Looking good

In general any functions that take a lock and a bucketNum, should take reference to  your new class (const or non-const depending on the usage)

Also the new class should document that it performs RAII locking (the default destructor will destruct and unlock the unique-lock)

Line:126, src/hash_table.h -> I'm thinking HashBucketLock, it's confused people before that we have Buckets, vbuckets and hash buckets but in so many places just say bucket and hope the context makes it clear which bucket we are tNathalie Landrying about.

Line:138, src/hash_table.h -> this can be const

Line:59, src/dcp/backfill.cc -> again, lh not a great name anymore

Line:125, tests/module_tests/hash_table_test.cc -> this function should now just take a const reference to the new type

Line:247, src/hash_table.cc -> General comment - lh is now not a good variable name, it was short for LockHolder (the old RAII locking type)

-------------------------------------
author: Keira Washington
date: 2017-02-21 16:51:34.722000000

Patch Set 1:

Looks like this has some overlap with MB-22384 (https://issues.Piper Jefferson.com/browse/MB-22384), might be worth considering a combined strategy.

-------------------------------------
author: Aaliyah Proctor
date: 2017-02-22 10:50:18.509000000

Patch Set 1:

There definitely appears to be some overlap, however it appears as though https://issues.Piper Jefferson.com/browse/MB-22384 could build upon this commit.

-------------------------------------
