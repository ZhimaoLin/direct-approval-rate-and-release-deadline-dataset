DESCRIPTION

MB-17534: provide options to disable the drift counter

The drift counter for each vbucket was added to aid in built-in
time synchronization. XDCR is planning to use the NTP server
for that purpose. Thus, as per requirements, disable the
application of drift in the following places

- Calculating CAS using Hybrid Logical Clock
- Shipping adjusted time using DCP (saves 11 bytes over the network)

Note that getAdjustedTime will apply the drift and setDriftCounterState
would still set the drift. Otherwise, the semantics of those APIs will
be broken.

Change-Id: I889cf2ee4b5a9c67c4315970c49def09c34bec7c


COMMENTS

author: Bobby Buck
date: 2016-02-17 02:04:51.057000000

Uploaded patch set 12: Patch Set 11 was rebased.

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 02:08:02.126000000

Patch Set 12:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1785/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 02:35:33.234000000

Patch Set 12: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1785/ : FAILURE

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/2528/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 03:04:01.543000000

Patch Set 12: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1787/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 03:12:07.877000000

Patch Set 12: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/2529/ : FAILURE

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1787/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 06:45:18.470000000

Patch Set 12: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/2530/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2016-02-17 06:53:16.339000000

Patch Set 12: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1787/ : SUCCESS

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/2530/ : SUCCESS

-------------------------------------
author: Abby Duran
date: 2016-02-17 18:07:33.299000000

Patch Set 12: Code-Review-1

(4 comments)

Line:233, src/vbucket.h -> Minor one: please put const to make it a const function

Line:238, src/vbucket.h -> Same comment as above

Line:283, src/vbucket.h -> Do we still need to check time_sync_enabled?

Line:1035, src/dcp/stream.cc -> If time_sync is enabled, but drift is disabled (for Watson), then we don't enable LWW-based XDCR? In this case, I think we should still create a timestamp by only invoking gethrtime(). Please correct me if I'm wrong.

-------------------------------------
author: Bobby Buck
date: 2016-03-05 01:06:56.295000000

Abandoned

This change isn't needed anymore

-------------------------------------
