DESCRIPTION

MB-17517: check for invalid CAS value in [set/delete]WithMeta

In a [set/delete]WithMeta call from either XDCR or from DCP,
a corrupt CAS value for the incoming item should return an
error

Change-Id: Id87627ae35ef711de4704a960b3aa7d1e9b9a48b


COMMENTS

author: Bobby Buck
date: 2016-01-22 22:04:34.271000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2016-01-22 22:04:42.654000000

Patch Set 2:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/428/

-------------------------------------
author: Abby Duran
date: 2016-01-22 22:42:50.236000000

Patch Set 2:

(1 comment)

Line:948, src/ep.cc -> i don't think we should check this for TAP backfill items from Couchbase 2.x cluster during the upgrade. Note that TAP item can have cas zero. My understanding is that a new cas is generated in unlocked_set below. Please correct me if I'm wrong.

-------------------------------------
author: Hugo Blankenship
date: 2016-01-22 22:44:15.329000000

Patch Set 2: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/428/ : SUCCESS

-------------------------------------
author: Bobby Buck
date: 2016-01-23 00:13:04.880000000

Patch Set 2:

(1 comment)

Line:948, src/ep.cc -> Why is a TAP item allowed to have a zero CAS? I didn't see CAS generation in unlocked_set, we just set the max_cas at the end.

-------------------------------------
author: Abby Duran
date: 2016-01-23 04:42:30.810000000

Patch Set 2: Code-Review+2

(1 comment)

Line:948, src/ep.cc -> Sorry, I was confused. TAP shouldn't ship zero CAS either.

-------------------------------------
author: Tate Garrett
date: 2016-01-23 04:42:33.152000000

Change has been successfully cherry-picked as 7f4d0dded692873e032a1648bd4a52525352b16a

-------------------------------------
