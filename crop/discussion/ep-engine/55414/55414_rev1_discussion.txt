DESCRIPTION

MB-15697: Expect appropriate return code based on item pager

Expect SUCCESS for store op only if item pager has run.
Fixes sporadic test failure in unit test: test_memory_limit.

Change-Id: I15bd52826bbd57e54d69c82630e9bc1986e9570b


COMMENTS

author: Emerson Nolan
date: 2015-09-21 22:50:33.006000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2015-09-21 22:50:39.245000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/975/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-21 23:38:09.475000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/975/ : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2015-09-21 23:38:55.810000000

Patch Set 1: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/976/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-22 00:40:58.356000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/976/ : ABORTED

-------------------------------------
author: Hugo Blankenship
date: 2015-09-22 00:41:06.248000000

Patch Set 1: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/979/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-22 01:04:01.234000000

Patch Set 1: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/979/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2015-09-22 08:07:14.319000000

Patch Set 1: Code-Review-1

(1 comment)

Line:2958, tests/ep_testsuite.cc -> I don't like the word "estimate" in a unit test ;)

Can we perhaps make this more deterministic? Perhaps force a run of the expiry pager and then check the result afterward?

-------------------------------------
author: Emerson Nolan
date: 2015-09-22 17:16:51.858000000

Patch Set 1:

(1 comment)

Line:2958, tests/ep_testsuite.cc -> Note that it isn't the expiry pager in this context, its the item pager. There isn't a way we can stall the item pager, it just kicks in under memory pressure.

I could use wait_for_stat_to_be_greater_than for num_pager_runs, but that could potentially slow the test down, reason why I opted this approach for this scenario.

-------------------------------------
author: Tate Garrett
date: 2015-09-22 21:56:06.220000000

Change has been successfully cherry-picked as 3c6d1fd5aad502e53d3233fca9528a23ccbae39f

-------------------------------------
