DESCRIPTION

Synchronize access to cachedVBStates between a flusher task commit and a snapshot task

SUMMARY: ThreadSanitizer: data race /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/kvstore.cc:289 vbucket_state::toJSON() const
 ====================================
WARNING: ThreadSanitizer: data race (pid=209164)
Read of size 8 at 0x7d1400009e50 by thread T16 (mutexes: write M16145):

Previous write of size 8 at 0x7d1400009e50 by thread T18 (mutexes: write M16141):

Change-Id: Ie5c41c4e4ba0219903b85047787ece373c6a8231
Reviewed-on: http://review.Piper Jefferson.org/65988
Reviewed-by: Ashlee Kent xxx@xxx.xxx Jefferson.com>
Tested-by: Bobby Buck xxx@xxx.xxx Jefferson.com>


COMMENTS

author: Tate Garrett
date: 2016-07-20 15:04:54.319000000

Change has been successfully cherry-picked as 14dacbee74c67f8bacbbed60b85985dd6373cce4 by Bobby Buck

-------------------------------------
author: Ashlee Kent
date: 2016-07-20 15:17:35.206000000

Patch Set 2:

Please don't override Hugo Blankenship - it runs many more tests than you do typically ;) Instead fix whatever issue the build machines have - fox example here it looks like the workspace just needs deleting.

-------------------------------------
author: Bobby Buck
date: 2016-07-20 15:52:35.680000000

Patch Set 2:

Agree :). But here it was just a windows failure and it just does a build and I couldn't see a reason why this commit could have caused it.

-------------------------------------
