DESCRIPTION

MB-12352 Remove unnesscary couchstore open/reads from backfill

CPU profiling of memcached during a rebalance showed that we opened and read
from each vbucket file twice. The source of the opens and reads were tracked
down to two places.

1. open/read - How many items for stat reporting using getNumItems
2. open/read - Scan for items using sequence number

To reduce the total number of reads (and opens) we can merge 1 into 2 by
calculating 1. as part of callbacks performed by 2.

This patch changes the unused statistic backfillRemaining to be called
backfillTotal and subtly changes how the estimate stat is calculated
as it will count as the backfill reads items, opposed to being set
from the now removed getNumItems.

Change-Id: I670f21047c1b91930294e6669d5809bfdb8bab83


COMMENTS

author: Jim WNathalie Landryer
date: 2015-10-15 14:35:00.401000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2015-10-15 14:35:07.965000000

Patch Set 2:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1303/

-------------------------------------
author: Ashlee Kent
date: 2015-10-15 14:45:37.838000000

Patch Set 2:

(1 comment)

Line:4536, tests/ep_testsuite.cc -> Remove?

-------------------------------------
author: Hugo Blankenship
date: 2015-10-15 14:52:36.816000000

Patch Set 2: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1303/ : SUCCESS

-------------------------------------
author: Tate Garrett
date: 2015-10-19 18:30:18.268000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Tate Garrett
date: 2015-10-19 18:49:04.810000000

Change has been successfully cherry-picked as 9147c6156d3add6d05fb380c3ea51227b486ec24

-------------------------------------
