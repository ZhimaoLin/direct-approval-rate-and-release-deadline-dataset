DESCRIPTION

 MB-20744: Increment reject ops for vbucket when items inserted into reject queue

In case of a failure to persist items, the items are added to the
reject queue in which the reject stats needs to be updated for
the associated vbucket.

Change-Id: I15b7ad26d8bcab5b6a437b8d172d8b914df8b683


COMMENTS

author: Bobby Buck
date: 2016-08-31 01:04:54.328000000

Uploaded patch set 2: Commit message was updated.

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:05:03.924000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1131/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:05:04.082000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/963/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:05:04.234000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/26/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:05:04.378000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1221/ (4/4)

-------------------------------------
author: Bobby Buck
date: 2016-08-31 01:05:38.853000000

Patch Set 2:

Created MB-20744 for tracking this.

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:27:51.659000000

Patch Set 2: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1131/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/1131/ )

ThreadSanitizer issue: data race /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/tasks.cc:36 FlusherTask::run()  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/1131/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/963/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1221/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/26/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:35:14.211000000

Patch Set 2: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1132/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-31 01:50:32.286000000

Patch Set 2: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1132/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/1132/ )

ThreadSanitizer issue: data race /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/tasks.cc:86 MultiBGFetcherTask::run()  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/1132/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/963/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1221/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/26/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2016-08-31 07:50:00.770000000

Patch Set 2: Code-Review-1

Can we add a unit test for this (maybe there's already a test which checks failure which we can simply expand?)

-------------------------------------
author: Bobby Buck
date: 2016-08-31 22:40:12.266000000

Patch Set 2:

I shall wait for the test written at http://review.Piper Jefferson.org/#/c/67206/ :). That seems to fit the bill ideally.

-------------------------------------
author: Ashlee Kent
date: 2016-09-29 21:03:59.164000000

Patch Set 2: -Code-Review

Given the fix here is pretty simple, it would be nice to get this into 4.6.0 (i.e. the watson) branch if possible.

-------------------------------------
author: Bobby Buck
date: 2016-09-30 12:22:54.333000000

Abandoned

Pushed this to the watson branch.

-------------------------------------
