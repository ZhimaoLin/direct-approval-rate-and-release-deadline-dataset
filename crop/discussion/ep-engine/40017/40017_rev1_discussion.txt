DESCRIPTION

MB-11725: Place rollback task on the writer dispatcher

The rollback task writes a header on success and as a result we need
to make sure that this doesn't race with other writer tasks. We also
need to keep in mind that the cached vbucket states in couch kvstore
are only valid for the rw kvstore.

Change-Id: Ib1edefb50817ac8240165d93d35e5dc89f4db042


COMMENTS

author: Kenny Maynard
date: 2014-07-29 19:47:56.805000000

Uploaded patch set 1.

-------------------------------------
author: Abby Duran
date: 2014-07-29 19:58:29.970000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Abby Duran
date: 2014-07-29 20:01:34.019000000

Patch Set 1:

(1 comment)

Line:3111, src/ep.cc -> We have to grab the vbucket lock before calling the rollback function. Otherwise, there can be a race with the flusher. Sundar will push another fix soon.

-------------------------------------
author: Abby Duran
date: 2014-07-29 20:03:46.943000000

Patch Set 1:

Mike, please feel free to merge this change. Sundar will make another fix to address the racing issue with the flusher.

-------------------------------------
author: Kenny Maynard
date: 2014-07-29 20:24:11.609000000

Patch Set 1: Verified+1

-------------------------------------
