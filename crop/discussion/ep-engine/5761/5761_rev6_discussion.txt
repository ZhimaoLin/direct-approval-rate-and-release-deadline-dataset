DESCRIPTION

MB-3618 Reset vbucket upon receiving OPAQUE_INITIAL_VB_STREAM message

ns_server is no longer deleting and recreating vbuckets on the
destination node, but instead relying on checkpoints.
However, if the destination node requests too old checkpoints that
are not in memory on the source node, the backfill will be required
from the source node.

If the backfill is required, the destination node should reset the
corresponding vbucket from memory and disk, so that it won't keep
any items that have been already deleted in the source node.

For supporting this, the source node will first send
"TAP_OPAQUE_INITIAL_VBUCKET_STREAM" message to the destination node
if the backfill is necessary, so that the destination node can reset
the target vbucket before receiving the backfill stream.

Change-Id: Idf8c9b7b72fb46f16d9ca917f3e3b17a5d32e86b


COMMENTS

author: Abby Duran
date: 2011-04-29 00:23:33.796000000

Uploaded patch set 6.

-------------------------------------
author: Abby Duran
date: 2011-04-29 00:23:36.531000000

Patch Set 6: I would prefer that you didn't submit this

Automatically re-added by Roselyn Villegas trivial rebase detection script.

-------------------------------------
author: Abby Duran
date: 2011-04-29 00:24:02.790000000

Patch Set 6: Verified; No score



-------------------------------------
author: Asher Vang
date: 2011-04-29 05:53:16.079000000

Patch Set 6: Looks good to me, approved



-------------------------------------
author: Abby Duran
date: 2011-04-29 06:12:46.555000000

Change has been successfully cherry-picked as f8c59279f3ed9960f474b531e932259cb09b6db5.

-------------------------------------
