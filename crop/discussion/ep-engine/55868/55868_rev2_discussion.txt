DESCRIPTION

MB-16366: Obtain vbstate readlock in numerous operations

Any KV update operations grab the lock early and test that VB state
is active, they keep the lock until complete, this certainly protects
queueDirty from colliding with a VB state change and also any other
paths we're unaware of.

The GET operations only use the read lock if the GET has triggered a
expiry/queueDirty.

A couple of other locations that trigger queueDirty are also interlocked
with VB state changes.

Change-Id: Icaee69520da230a9fdde6eb85365a7ddae790fd6


COMMENTS

author: Jim WNathalie Landryer
date: 2015-10-09 14:25:53.342000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2015-10-09 14:25:58.405000000

Patch Set 2:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1238/

-------------------------------------
author: Hugo Blankenship
date: 2015-10-09 14:52:31.632000000

Patch Set 2: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1238/ : SUCCESS

-------------------------------------
author: Abby Duran
date: 2015-10-09 19:51:33.013000000

Patch Set 2: Code-Review+2

-------------------------------------
author: Tate Garrett
date: 2015-10-09 19:51:34.920000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
author: Abby Duran
date: 2015-10-09 19:51:37.485000000

Patch Set 3: Patch Set 2 was rebased

-------------------------------------
author: Tate Garrett
date: 2015-10-09 20:03:08.357000000

Change has been successfully cherry-picked as 11ae199f2cd6850af7b8d546947bf27805484e3c

-------------------------------------
