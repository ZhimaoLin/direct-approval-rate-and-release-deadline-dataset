DESCRIPTION

MB-18650: Speedup test 'dcp consumer's processer task behavior' by ~50x

test_dcp_consumer_processer_behavior operates by storing items such
that mem_used reaches a given fraction of ep_max_size. However it
checks this condition on every loop iteration; looking up a full set
of stats.

get_int_stat() is surprisingly expensive - that call alone accounts
for 97%(!) of the test runtime (including it's callees).

Simplify by only calling get_int_stat() every 100 iterations (similar
to other tests) - we don't need to be at the exact fraction of
ep_max_size, as long as we are over the threshold.

This reduces the test runtime under ThreadSanitizer (which suffers
particulary with all the memory allocations get_int_stat() triggers
from 99s to 1.8s.

Change-Id: Iceb8bda9b83196404499886a42f574ebc9aba1db


COMMENTS

author: Ashlee Kent
date: 2016-03-10 17:19:04.030000000

Uploaded patch set 4: Patch Set 3 was rebased.

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 17:35:10.749000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/93/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 17:58:47.368000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/61/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 18:00:21.750000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/108/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 18:06:50.461000000

Patch Set 4: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/93/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/108/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-watson/108/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/61/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2016-03-10 21:44:30.779000000

Patch Set 4: -Verified

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/101/ (2/3)

-------------------------------------
author: Tate Garrett
date: 2016-03-11 11:46:52.519000000

Change has been successfully cherry-picked as fb37a1876447369ca05fce9346ea1366f9232746

-------------------------------------
