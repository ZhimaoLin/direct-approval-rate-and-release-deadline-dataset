DESCRIPTION

MB-23530: Prevent replacing with cas on deleted item

It was previously possible in some cases to replace a deleted item if
the correct CAS value was given. A replace with a cas value resolves
internally to OPERATION_CAS, which is treated as a set.

We previously only checked if an item was deleted if the cas did _not_
match, but even if the cas is correct, a replace with a cas value should
fail if the item is deleted.

Change-Id: Id1eeaeb5326b7a143c7213f07c774f02623bff8d


COMMENTS

author: Jace Townsend
date: 2017-04-05 08:49:47.323000000

Uploaded patch set 3.

-------------------------------------
author: Hugo Blankenship
date: 2017-04-05 09:31:00.891000000

Patch Set 3: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4250/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/5464/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/4973/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/5679/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2017-04-05 10:32:57.704000000

Patch Set 3: Code-Review-1

As discussed, needs tests for this, plus we should consider the Deleted-with-Value -> Deleted transition.

-------------------------------------
