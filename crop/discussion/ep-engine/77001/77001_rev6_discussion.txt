DESCRIPTION

MB-22749: Decrement item count for updates in full eviction

Decrement the item count from the hashtable in case of an update
in full eviction mode. Reading the total item count from the
underlying store results in a slowdown in updating the item
count in the hash table.

Change-Id: I6bcb96bf76aef59be82c219877cb0c1343f75241


COMMENTS

author: Bobby Buck
date: 2017-05-09 03:51:32.984000000

Uploaded patch set 6.

-------------------------------------
author: Hugo Blankenship
date: 2017-05-09 04:07:47.238000000

Patch Set 6: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6354/ : FAILURE

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4862/ : FAILURE

AddressSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-addresssanitizer-master/ep-engine/src/stored-value.h:262:24 in StoredValue::markUpdateOnDelete(bool) ( http://cv.jenkins.couchbase.com//job/ep-engine-addresssanitizer-master/4862/ )

Failure of a CTest test  7/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/4862/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/111/ : FAILURE

ThreadSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/stored-value.h:262 in StoredValue::markUpdateOnDelete(bool)  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/111/ )

Failure of a CTest test  8/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/111/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5554/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-05-09 15:01:53.418000000

Patch Set 6:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6375/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4862/ : FAILURE

AddressSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-addresssanitizer-master/ep-engine/src/stored-value.h:262:24 in StoredValue::markUpdateOnDelete(bool) ( http://cv.jenkins.couchbase.com//job/ep-engine-addresssanitizer-master/4862/ )

Failure of a CTest test  7/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/4862/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/111/ : FAILURE

ThreadSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/stored-value.h:262 in StoredValue::markUpdateOnDelete(bool)  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/111/ )

Failure of a CTest test  8/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/111/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5554/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-05-09 15:32:50.953000000

Patch Set 6:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6378/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4862/ : FAILURE

AddressSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-addresssanitizer-master/ep-engine/src/stored-value.h:262:24 in StoredValue::markUpdateOnDelete(bool) ( http://cv.jenkins.couchbase.com//job/ep-engine-addresssanitizer-master/4862/ )

Failure of a CTest test  7/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/4862/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/111/ : FAILURE

ThreadSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/stored-value.h:262 in StoredValue::markUpdateOnDelete(bool)  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/111/ )

Failure of a CTest test  8/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/111/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5554/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-05-09 15:55:58.781000000

Patch Set 6:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6382/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4862/ : FAILURE

AddressSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-addresssanitizer-master/ep-engine/src/stored-value.h:262:24 in StoredValue::markUpdateOnDelete(bool) ( http://cv.jenkins.couchbase.com//job/ep-engine-addresssanitizer-master/4862/ )

Failure of a CTest test  7/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/4862/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/111/ : FAILURE

ThreadSanitizer issue: heap-use-after-free /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-master/ep-engine/src/stored-value.h:262 in StoredValue::markUpdateOnDelete(bool)  ( http://cv.jenkins.couchbase.com//job/ep-engine-threadsanitizer-master/111/ )

Failure of a CTest test  8/26 Test  #5: ep-engine_ep_unit_tests .................. ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-master/111/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5554/ : SUCCESS

-------------------------------------
