DESCRIPTION

MB-14388: Update snapshot range when vbucket changes to active

Update the snapshot range when a vbucket becomes active, from
being a replica, in a failover scenario, as there is a small
window when the snapshot_start_seqno can become greater than
the vbucket_high_seqno.

Change-Id: I7299fb9a70e0f33f152d58fd1dcda33256428c9f


COMMENTS

author: Emerson Nolan
date: 2015-04-13 19:21:23.498000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2015-04-13 19:21:27.799000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/141/

-------------------------------------
author: Kenny Maynard
date: 2015-04-13 19:36:39.156000000

Patch Set 1:

(3 comments)

Line:1154, src/ep.cc -> Only if it's not a takeover. You can move the updateSnapshot call into the if statement below.

Line:1161, src/checkpoint.cc -> lastBySeqno +1

We always set the start sequence number to the first by sequence number of this checkpoint. You should also set the snapshot end to lastBySeqno + 1 in this if statement.

Line:1164, src/checkpoint.cc -> Should be in an else statement.

-------------------------------------
author: Emerson Nolan
date: 2015-04-13 20:25:18.957000000

Patch Set 1:

(3 comments)

Thanks Michael.

Line:1154, src/ep.cc -> Done

Line:1161, src/checkpoint.cc -> Done

Line:1164, src/checkpoint.cc -> Done

-------------------------------------
author: Hugo Blankenship
date: 2015-04-13 20:40:37.850000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/141/ : ABORTED

-------------------------------------
author: Tate Garrett
date: 2015-04-14 16:41:05.840000000

Change has been successfully cherry-picked as 09e039322497fb5009da4dfc9ffd3d2466f678ef

-------------------------------------
