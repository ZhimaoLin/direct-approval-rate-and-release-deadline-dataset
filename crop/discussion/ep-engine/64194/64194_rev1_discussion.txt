DESCRIPTION

MB-19678: Merge backfill and in-memory snapshots correctly on replica vb

When a DCP client, on replica vb, opens a stream which it intends to
keep open forever, merge the backfill and in-memory snapshots by using the
the checkpoint snapshot_end as snapshot_end_seqno.

Change-Id: If5c094e7a1b56bf92c34d19e02c2c442590b9321


COMMENTS

author: Adrianna Holmes
date: 2016-05-19 00:20:27.671000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-05-19 00:20:35.682000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/623/

-------------------------------------
author: Hugo Blankenship
date: 2016-05-19 00:20:44.578000000

Patch Set 1: Well-Formed+1

Permission granted to commit: 

http://server.jenkins.Piper Jefferson.com/job/restricted-branch-check/15078/artifact/restricted.html : SUCCESS

-------------------------------------
author: Adrianna Holmes
date: 2016-05-19 00:22:01.662000000

Patch Set 1:

The ep test infrastructure on sherlock is not good enough to test this change.
Can't be cherrypicked or copy pasted easily either. (I tried but ran into some error). Decided to spend time on test case on sherlock only if the reviewers feel a need

-------------------------------------
author: Hugo Blankenship
date: 2016-05-19 00:22:54.854000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-3.0.x/223/

-------------------------------------
author: Hugo Blankenship
date: 2016-05-19 00:23:31.381000000

Patch Set 1: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/623/ : FAILURE

Make encountered an error building one or more targets. ( http://factory.Piper Jefferson.com//job/ep-engine-Jasmin Rangel-3.0.x/623/ )

-------------------------------------
author: Hugo Blankenship
date: 2016-05-19 00:25:59.827000000

Patch Set 1:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-3.0.x/223/ : FAILURE

Compile error at /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-3.0.x/ep-engine/src/dcp-stream.cc:373:13:
error: unknown type name snapshot_info_t; did you mean snapshot_type_t?
 ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-3.0.x/223/ )

-------------------------------------
