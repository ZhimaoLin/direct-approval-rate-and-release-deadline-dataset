DESCRIPTION

MB-5662 Don't skip updating vb_state in couchKVStore.

As vbucket state consists of vb_state, checkpoint_id, and other
fields and we remove duplicate vb snapshot tasks, we should not
skip updating vb_state in couchKVStore.

Change-Id: Id40089af5d5987784e15080e40ebbd4563878cd7


COMMENTS

author: Abby Duran
date: 2012-06-23 08:40:24.447000000

Uploaded patch set 6.

-------------------------------------
author: Audrina Olson
date: 2012-06-25 17:34:07.917000000

Patch Set 6: Verified; Looks good to me, approved



-------------------------------------
author: Roman Murillo
date: 2012-06-25 18:08:37.193000000

Patch Set 6: (1 inline comment)



Line:689, couch-kvstore/couch-kvstore.cc -> I added this change for Alk's bug MB-5027. Actually, it had readVBState() before, and now you are removing this. I think you probably still want readVBState() otherwise maxDeletedSeqNo would have some undefined value.

-------------------------------------
author: Audrina Olson
date: 2012-06-25 18:16:34.327000000

Patch Set 6: (1 inline comment)



Line:689, couch-kvstore/couch-kvstore.cc -> Good point. I verified this with non xdcr testing so worked ok. However, you are absolutely right that we need to read VBState before save VBState to correctly calculate maxDeleteSeqNo!

-------------------------------------
