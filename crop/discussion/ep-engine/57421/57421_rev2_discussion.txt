DESCRIPTION

Destroy cookie reference before checking mapped memory

Context: test_defragmenter
The test sporadically fails with the mapped memory
not falling to the estimated value when run with valgrind.
In this scenario, release the cookie before we fail the
test to avoid a leak.

Change-Id: Ifdfe012fc7f47f4bfd265857551e7b95015f6925


COMMENTS

author: Emerson Nolan
date: 2015-12-02 17:57:13.869000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2015-12-02 18:01:01.681000000

Patch Set 2:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/933/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2015-12-02 18:12:55.186000000

Patch Set 2: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1689/ : FAILURE

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/933/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2015-12-02 18:13:26.550000000

Patch Set 2: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1691/ (2/2)

-------------------------------------
author: Hugo Blankenship
date: 2015-12-02 18:23:51.187000000

Patch Set 2: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/933/ : SUCCESS

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/1691/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2015-12-02 18:40:11.985000000

Patch Set 2: Code-Review+2

We need to work out why the test sometimes fails in Valgrind (or if not, disable it when run under Valgrind if memory tracking doesn't work correctly), but I'm ok with this as a general robustness improvement.

-------------------------------------
author: Emerson Nolan
date: 2015-12-02 18:51:34.766000000

Patch Set 2:

Agreed Dave.

-------------------------------------
author: Adrianna Holmes
date: 2015-12-02 18:57:52.070000000

Patch Set 2: Code-Review+2

-------------------------------------
author: Abby Duran
date: 2015-12-02 19:00:19.083000000

Patch Set 2: Code-Review+2

-------------------------------------
author: Tate Garrett
date: 2015-12-02 19:00:20.587000000

Change has been successfully cherry-picked as fd4d618b3541e8ae09226e3c15250a13c0e15d11

-------------------------------------
