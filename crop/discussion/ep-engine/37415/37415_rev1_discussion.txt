DESCRIPTION

MB-11177 Should not delete stale files in getMulti()

This causes the XDCR to become significant slower because of
the full directory scan.

Change-Id: I140cc24b6f3685fad71a032041cd50a30003908d


COMMENTS

author: Abby Duran
date: 2014-05-22 00:21:41.632000000

Uploaded patch set 1.

-------------------------------------
author: Ellie Kidd
date: 2014-05-22 00:24:09.664000000

Patch Set 1:

(1 comment)

Line:739, src/couch-kvstore/couch-kvstore.cc -> this is not necessary as couchstore_compact_db_ex will auto remove the file if the api call had failed

-------------------------------------
author: Abby Duran
date: 2014-05-22 00:31:39.845000000

Patch Set 1:

Sundar pushed the new fix. I will abandon this change.

-------------------------------------
author: Abby Duran
date: 2014-05-22 00:31:43.988000000

Abandoned

-------------------------------------
author: Miley Adams
date: 2014-05-22 00:31:50.989000000

Patch Set 1:

so this change means old db files can only be deleted during warmup.

What about adding some counters to decrease the calling frequency?

-------------------------------------
author: Ellie Kidd
date: 2014-05-22 00:39:31.763000000

Patch Set 1:

David, I guess we could add counters but I think determining a good frequency may be difficult since only XDCR calls a large number of getMulti requests and other times there are fewer calls.
Please do suggest any scheme for the frequency determination of the cleanup calls that you may have?
thanks

-------------------------------------
