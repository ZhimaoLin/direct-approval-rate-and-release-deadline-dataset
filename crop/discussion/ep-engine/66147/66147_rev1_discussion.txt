DESCRIPTION

MB-20235: Fix wake's incorrect work counting

MB-20061 introduced a better futureQueue object but has
introduced a ExecutorPool work accounting bug. The work
counter should only be increased for tasks in the readyQueue,
MB-20061 would sometimes add 1 for items in the futureQueue.
The counter would then never reach 0 and the fetchNextTask loop
would never yield (causing high CPU).

Note that when MB-18453 is merged up from sherlock, this code
will be tweaked again to remove any readyQueue push code
from the wake path.

Change-Id: I010de48666fc5327bd2f5912f10dad7177ec5a37


COMMENTS

author: Jim WNathalie Landryer
date: 2016-07-25 09:58:04.386000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-07-25 09:58:09.777000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1041/ (1/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-07-25 09:58:09.922000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/808/ (2/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-07-25 09:58:10.066000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/962/ (3/3)

-------------------------------------
author: Hugo Blankenship
date: 2016-07-25 10:11:28.426000000

Patch Set 1: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/962/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/808/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1041/ : SUCCESS

-------------------------------------
author: Keira Washington
date: 2016-07-25 10:35:24.630000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Adrianna Holmes
date: 2016-07-25 21:44:36.273000000

Patch Set 1: Code-Review+2

-------------------------------------
author: Tate Garrett
date: 2016-07-26 08:29:14.496000000

Change has been successfully cherry-picked as 50838e8aede895cac523190676e70528ab57017b by Jim WNathalie Landryer

-------------------------------------
