DESCRIPTION

MB-23734: Do memory mgmt across backfills in Ephemeral backfills

In Ephemeral buckets we currently do not have backfill memory mgmt.
Mainly because upon increased memory usage by backfill items we cannot
easily pause the backfill midway because pausing a backfill will
increase the duplicate items in the ephemeral sequential data structure.

This commit adds memory mgmt across backfills (each vbucket is an
individual backfill). Upon full usage of the backfill buffer we stop
running other backfills until the backfill buffer is empty again.

However once a backfill starts it runs till completion even if its
memory usage goes beyond the buffer size.

Change-Id: If5f77561a856b5001de159cd4655eb30c71e222c


COMMENTS

author: Adrianna Holmes
date: 2017-04-26 22:02:52.020000000

Uploaded patch set 1.

-------------------------------------
author: Adrianna Holmes
date: 2017-04-26 22:05:50.049000000

Topic set to Ephemeral Backfill

-------------------------------------
author: Hugo Blankenship
date: 2017-04-26 22:37:06.026000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/16.04-ep-engine-threadsanitizer-master/37/ : FAILURE

Timeout of a CTest test 26/26 Test #26: ep_perfsuite.ephemeral ...................} ( http://cv.jenkins.Piper Jefferson.com//job/16.04-ep-engine-threadsanitizer-master/37/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/6007/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5484/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6267/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4786/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-04-26 23:16:42.573000000

Patch Set 1:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/16.04-ep-engine-threadsanitizer-master/40/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/6007/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/5484/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/6267/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/4786/ : SUCCESS

-------------------------------------
