DESCRIPTION

MB-22513: Only calculate hash bucket once

In codepaths that call HashTable::unlocked_addNewStoredValue, we often
find the hash bucket at some point earlier in the path and then again in
HashTable::unlocked_addNewStoredValue. Therefore we end up calculating
the hash twice.

We change HashTable::unlocked_addNewStoredValue to not calculate the
hash bucket and instead have it passed in as an argument. This requires
some changes earlier in the call path which is what the bulk of this
commit is.

Change-Id: Ib0c630030233b35f11336b8d7cf181370d17f146


COMMENTS

author: Aaliyah Proctor
date: 2017-02-20 11:41:46.262000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2017-02-20 12:05:11.682000000

Patch Set 2: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/2657/ : ABORTED

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/2657/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/3427/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3829/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/4044/ : SUCCESS

-------------------------------------
author: Hugo Blankenship
date: 2017-02-20 12:25:12.915000000

Patch Set 2: Verified+1

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/3427/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/3829/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/4044/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/2663/ : SUCCESS

-------------------------------------
author: Jim WNathalie Landryer
date: 2017-02-20 13:57:31.916000000

Patch Set 2: Code-Review-1

(4 comments)

Line:68, tests/mock/mock_vbucket.h -> same camelCase please

Line:310, src/hash_table.h -> can you change to bucketNum

Line:254, src/hash_table.cc -> change to bucketNum

Line:294, src/hash_table.cc -> same again, camel case

-------------------------------------
