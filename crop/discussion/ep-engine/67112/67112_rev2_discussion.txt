DESCRIPTION

MB-18453: Fix incorrect waketime for executor threads

When a thread is done with a task from a particular queue,
it calls doneWork() which was setting its current Queue type
to NONE. This was causing the subsequent reschedule to not
pick the earliest waketime and end up sleeping longer than
necessary. In rare occasions, this can even lead to starvation.
Simplify the reschedule logic as part of this fix.

Change-Id: Ifdad1d21e624982460046393d4c377247da90735


COMMENTS

author: Ellie Kidd
date: 2016-08-27 07:05:12.499000000

Uploaded patch set 2.

-------------------------------------
author: Hugo Blankenship
date: 2016-08-27 07:05:18.682000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1212/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-27 07:05:18.816000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1120/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-27 07:05:18.951000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/954/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-27 07:05:19.086000000

Patch Set 2:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/15/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-08-27 07:19:29.546000000

Patch Set 2: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-master/15/ : FAILURE

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-addresssanitizer-master/15/ )

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-master/954/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master/1212/ : SUCCESS

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-master/1120/ : SUCCESS

-------------------------------------
author: Ashlee Kent
date: 2016-08-27 08:22:56.497000000

Patch Set 2: Code-Review-1

Change looks reasonable, but please add a test for this to validate the expected behaviour.

-------------------------------------
author: Tate Garrett
date: 2016-09-01 00:42:58.475000000

Change has been successfully cherry-picked as 63e4ba7ae23a0d34127c8c408d00f72ea2e9143f by Abby Duran

-------------------------------------
