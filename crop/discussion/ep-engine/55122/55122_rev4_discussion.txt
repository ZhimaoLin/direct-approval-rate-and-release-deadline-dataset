DESCRIPTION

Reporting accurate vbtakeover stats for active streams

If a DCP active stream's cursor was dropped by checkpoint
remover's cursor dropper, then until the reconnection
is made by the consumer, dcp-vbtakeover stats should
report the best available information rather than stating
"stream not found".

Change-Id: Ia8ab9b8daeaf0b5f96f137d7a2c057c201a855e4


COMMENTS

author: Emerson Nolan
date: 2015-09-08 23:17:07.239000000

Uploaded patch set 4.

-------------------------------------
author: Hugo Blankenship
date: 2015-09-08 23:17:11.788000000

Patch Set 4:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/936/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-08 23:34:05.097000000

Patch Set 4: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/936/ : ABORTED

-------------------------------------
author: Hugo Blankenship
date: 2015-09-08 23:34:07.377000000

Patch Set 4: -Verified

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/937/

-------------------------------------
author: Hugo Blankenship
date: 2015-09-08 23:42:00.014000000

Patch Set 4: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-master-multi/937/ : FAILURE

-------------------------------------
author: Emerson Nolan
date: 2015-09-08 23:43:06.841000000

Removed the following votes:

* Verified-1 by Hugo Blankenship xxx@xxx.xxx Jefferson.com>


-------------------------------------
author: Emerson Nolan
date: 2015-09-08 23:43:09.098000000

Patch Set 4: Verified+1

CV fails on possible windows env issue.

-------------------------------------
author: Adrianna Holmes
date: 2015-09-08 23:56:47.296000000

Patch Set 4: Code-Review+1

-------------------------------------
author: Abby Duran
date: 2015-09-09 00:02:30.739000000

Patch Set 4:

(1 comment)

Line:811, src/dcp/stream.cc -> Is this a consistent read (i.e., thread-safe)?

-------------------------------------
author: Abby Duran
date: 2015-09-09 00:38:52.953000000

Patch Set 4: Code-Review-1

(1 comment)

Line:637, src/dcp/producer.cc -> Please check if vb is valid or not and remove the entry from the map if not valid.

-------------------------------------
author: Emerson Nolan
date: 2015-09-09 00:41:59.991000000

Patch Set 4:

(2 comments)

Line:637, src/dcp/producer.cc -> Done

Line:811, src/dcp/stream.cc -> Since the producer is the only one that accesses the stream, and as we get the queueLock in the producer before we make this call, we should be fine.

-------------------------------------
author: Tate Garrett
date: 2015-09-09 01:33:18.383000000

Change has been successfully cherry-picked as 4045c19aa7796cbdc5bc49f40409c735982026cc

-------------------------------------
