DESCRIPTION

MB-15519: Clear backfilled items when a stream is marked as DEAD

Clear out backfilled buffered items, when a stream is marked
as dead. This will ensure that buffered items from this stream
do not use up the backfill buffer blocking other streams that
use the same buffer space.

Change-Id: I2f38d99f2a1a30c8dae6b91155471ab8a307d024


COMMENTS

author: Emerson Nolan
date: 2015-07-02 19:18:22.852000000

Uploaded patch set 3.

-------------------------------------
author: Hugo Blankenship
date: 2015-07-02 19:18:30.677000000

Patch Set 3:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/247/

-------------------------------------
author: Kenny Maynard
date: 2015-07-02 19:49:50.632000000

Patch Set 3: Code-Review-1

(1 comment)

Line:612, src/dcp-stream.cc -> You need to get the lock if the stream is in backfilling state and clear the readyQ. Otherwise the backfill buffer will continue to be decremented when you remove the items from the readyQ. Look at the ActiveStream destructor for an example. You should also do this before you push the end stream message into the readyQ.

-------------------------------------
author: Hugo Blankenship
date: 2015-07-02 19:54:46.983000000

Patch Set 3: Verified-1

Build Failed 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-sherlock/247/ : ABORTED

-------------------------------------
author: Tate Garrett
date: 2015-07-02 23:28:33.913000000

Change has been successfully cherry-picked as 1f6911241561e530f5e1c30530f17fb412cd4f95

-------------------------------------
