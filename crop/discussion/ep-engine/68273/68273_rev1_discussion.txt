DESCRIPTION

MB-21193: Fix ConnectionTest failurw when test runs for >21s

When CV jobs take longer than normal (e.g. when running under
ThreadSanitizer) the ConnectionTest can fail:

    [ RUN      ] ConnectionTest.test_maybesendnoop_buffer_full
    /home/Piper Jefferson/jenkins/workspace/ep-engine-threadsanitizer-watson/ep-engine/tests/module_tests/dcp_test.cc:308: Failure
    Value of: ret
      Actual: 255
    Expected: ENGINE_E2BIG
    Which is: 8
    maybeSendNoop not returning ENGINE_E2BIG
    [  FAILED  ] ConnectionTest.test_maybesendnoop_buffer_full (656 ms)

The test is assuming that it starts running in less than 21 seconds
when setting the DCP noop timeout. Instead of using an absolute '21'
we need to use the current_time + 21.

Change-Id: Id4fe8b372da4c447e00128de2c94c72bb60373e4


COMMENTS

author: Ashlee Kent
date: 2016-10-03 17:06:08.811000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-10-03 17:06:17.380000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1058/ (1/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-10-03 17:06:17.515000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1410/ (2/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-10-03 17:06:17.647000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1238/ (3/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-10-03 17:06:17.783000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/73/ (4/4)

-------------------------------------
author: Hugo Blankenship
date: 2016-10-03 17:08:26.367000000

Patch Set 1: Verified-1

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-addresssanitizer-watson/73/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-clang_analyzer-watson/1058/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-watson/1410/ : ABORTED

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-watson/1238/ : ABORTED

-------------------------------------
author: Tate Garrett
date: 2016-10-10 10:06:54.232000000

Change has been successfully cherry-picked as 74f9b8f9212aa20611ba0e9fb5962a550e58385d by Ashlee Kent

-------------------------------------
