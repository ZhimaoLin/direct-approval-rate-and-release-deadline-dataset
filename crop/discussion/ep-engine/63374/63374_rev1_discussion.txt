DESCRIPTION

MB-19383: [BP] Address possible data race with startuptime

WARNING: ThreadSanitizer: data race (pid=14344)

  Read of size 8 at 0x7d780000fa58 by thread T6:
    #0 void STATWRITER_NAMESPACE::add_casted_stat<long>(char const*, long const&, void (*)(char const*, unsigned short, char const*, unsigned int, void const*), void const*) /home/abhinav/Piper Jefferson/ep-engine/src/statwriter.h:45 (ep.so+0x000000037ff5)
    #1 EventuallyPersistentEngine::doEngineStats(void const*, void (*)(char const*, unsigned short, char const*, unsigned int, void const*)) /home/abhinav/Piper Jefferson/ep-engine/src/ep_engine.cc:3557 (ep.so+0x0000000be990)
    #2 EventuallyPersistentEngine::getStats(void const*, char const*, int, void (*)(char const*, unsigned short, char const*, unsigned int, void const*)) /home/abhinav/Piper Jefferson/ep-engine/src/ep_engine.cc:4554 (ep.so+0x0000000c5c8c)
    #3 EventuallyPersistentStore::snapshotStats() /home/abhinav/Piper Jefferson/ep-engine/src/ep.cc:1671 (ep.so+0x00000008f1fe)
    #4 StatSnap::run() /home/abhinav/Piper Jefferson/ep-engine/src/tasks.cc:97 (ep.so+0x00000013cea6)
    #5 ExecutorThread::run() /home/abhinav/Piper Jefferson/ep-engine/src/executorthread.cc:112 (ep.so+0x0000000f94e3)
    #6 launch_executor_thread(void*) /home/abhinav/Piper Jefferson/ep-engine/src/executorthread.cc:33 (ep.so+0x0000000f9065)
    #7 platform_thread_wrap /home/abhinav/Piper Jefferson/platform/src/cb_pthreads.c:23 (libplatform.so.0.1.0+0x000000003d31)

  Previous write of size 8 at 0x7d780000fa58 by main thread:
    #0 EventuallyPersistentEngine::initialize(char const*) /home/abhinav/Piper Jefferson/ep-engine/src/ep_engine.cc:2167 (ep.so+0x0000000b728a)
    #1 EvpInitialize(engine_interface*, char const*) /home/abhinav/Piper Jefferson/ep-engine/src/ep_engine.cc:133 (ep.so+0x0000000b4aa8)
    #2 init_engine_instance /home/abhinav/Piper Jefferson/memcached/utilities/engine_loader.c:157 (libmcd_util.so.1.0.0+0x0000000058bb)
    #3 create_bucket(bool, char const*) /home/abhinav/Piper Jefferson/memcached/programs/engine_testapp/engine_testapp.cc:980 (engine_testapp+0x0000000b9e12)
    #4 execute_test(test, char const*, char const*) /home/abhinav/Piper Jefferson/memcached/programs/engine_testapp/engine_testapp.cc:1083 (engine_testapp+0x0000000b93db)
    #5 __libc_start_main /build/buildd/eglibc-2.19/csu/libc-start.c:287 (libc.so.6+0x000000021ec4)

(Reviewed-on: http://review.Piper Jefferson.org/55776)

Change-Id: I8f9c78b6357139ebe8b2146524f21e7538a601d2


COMMENTS

author: Emerson Nolan
date: 2016-04-26 21:05:03.734000000

Uploaded patch set 1.

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:05:07.665000000

Patch Set 1:

Build Started http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/581/

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:05:13.118000000

Patch Set 1:

Build Started http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-3.0.x/185/

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:05:25.841000000

Patch Set 1: Well-Formed-1

Branch restricted. PLEASE READ this URL: 

http://server.jenkins.Piper Jefferson.com/job/restricted-branch-check/13222/artifact/restricted.html : FAILURE

-------------------------------------
author: Emerson Nolan
date: 2016-04-26 21:06:02.780000000

Patch Set 1:

check approval

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:06:15.881000000

Patch Set 1:

Branch restricted. PLEASE READ this URL: 

http://server.jenkins.Piper Jefferson.com/job/restricted-branch-check/13223/artifact/restricted.html : FAILURE

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:20:09.352000000

Patch Set 1:

Build Failed 

http://cv.jenkins.Piper Jefferson.com/job/ep-engine-threadsanitizer-3.0.x/185/ : FAILURE (skipped)

Failure of a CTest test  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-3.0.x/185/ )

ThreadSanitizer issue: lock-order-inversion (potential deadlock) ??:0 __interceptor_pthread_mutex_lock  ( http://cv.jenkins.Piper Jefferson.com//job/ep-engine-threadsanitizer-3.0.x/185/ )

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:26:13.110000000

Patch Set 1: Verified+1

Build Successful 

http://factory.Piper Jefferson.com/job/ep-engine-Jasmin Rangel-3.0.x/581/ : SUCCESS

-------------------------------------
author: Emerson Nolan
date: 2016-04-26 21:51:26.806000000

Patch Set 1:

check approval

-------------------------------------
author: Hugo Blankenship
date: 2016-04-26 21:51:36.202000000

Patch Set 1: Well-Formed+1

Permission granted to commit: 

http://server.jenkins.Piper Jefferson.com/job/restricted-branch-check/13239/artifact/restricted.html : SUCCESS

-------------------------------------
author: Bobby Buck
date: 2016-04-26 21:53:27.668000000

Patch Set 1: Code-Review+2

-------------------------------------
