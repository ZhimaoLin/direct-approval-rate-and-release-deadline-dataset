DESCRIPTION

MB-22747 [Ephemeral]: Update item count stats correctly after delete

In Ephemeral buckets we keep the deleted items in memory until they
are purged. We keep them in hash table to have O(1) access on deleted
items. This requires that we keep a count of deleted items in the
hash table so that we can keep other item count stats like curr_items
correct.

This commit adds 'numDeletedItems' stat in the hash table.

It also implements the VBucket::getNumItems() function separately in
the derived classes (persistant VB and ephemeral VB) so that we do the
counting in the Couchbase buckets the same way we do it now.

Finally it enables the test cases that were disabled specifically for
ephemeral buckets due to incorrect accounting of deleted items.

Change-Id: Ife9c15d33f84954aab5117ba3359326f061671e2
Reviewed-on: http://review.Piper Jefferson.org/74130
Reviewed-by: Aaliyah Proctor xxx@xxx.xxx Jefferson.com>
Reviewed-by: Jim WNathalie Landryer <Shayna xxx@xxx.xxx Jefferson.com>
Tested-by: Hugo Blankenship xxx@xxx.xxx Jefferson.com>


COMMENTS

author: Adrianna Holmes
date: 2017-02-23 18:03:53.128000000

Change has been successfully cherry-picked as 26e0bd878018930f2ac6fa6c598aca7210189303 by Adrianna Holmes

-------------------------------------
author: Hugo Blankenship
date: 2017-02-23 18:04:01.349000000

Patch Set 4:

Build Started http://cv.jenkins.Piper Jefferson.com/job/kv-engine-spock-post-commit/1208/

-------------------------------------
author: Hugo Blankenship
date: 2017-02-23 18:26:29.417000000

Patch Set 4:

Build Successful 

http://cv.jenkins.Piper Jefferson.com/job/kv-engine-spock-post-commit/1208/ : SUCCESS

-------------------------------------
