DESCRIPTION

tmf: Add null-annotations to the state system

Big patch bringing JDT null-analysis annotations to the state system and
related classes. It's relatively straightforward, some null checks are now
redundant, and other stuff is now xxx@xxx.xxx which enforces null
checks before use.

The main downside is that most Java standard methods (toString(), equals(),
List.get(), etc.) do not use those types of annotations, so nullability needs
to be checked every time they are used.

In cases where their Javadoc mentions that they should not return null, I simply
extracted the value in a xxx@xxx.xxx variable. This is a bit ugly, but
I really think it's worth the much more robust compile-time checking we get
from the annotations (and if the Java classes ever support those, those
SuppressWarnings will emit "unneeded SuppressWarning" warnings and it will
be very simple to remove them).

The use of null annotations on fields requires a recent version of JDT to compile,
which means the project can only be built with Eclipse 4.3+. However, since there
are no run-time dependencies, the compiled plugin can then be installed on previous
versions with no problems (I tested with 4.2). I don't think this limiation is
problematic.

Change-Id: Id3e9ed49c3fdda7098dc1f380dc56710c55b92ae
Signed-off-by: Braxton Mccarthy xxx@xxx.xxx


COMMENTS

author: Braxton Mccarthy
date: 2013-11-27 00:23:11.000000000

Uploaded patch set 3.

-------------------------------------
author: Brenden Conley
date: 2013-11-27 00:35:19.000000000

Patch Set 3:

Build Started https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/4195/

-------------------------------------
author: Brenden Conley
date: 2013-11-27 01:19:29.000000000

Patch Set 3: Verified+1

Build Successful 

https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/4195/ : SUCCESS

-------------------------------------
author: Kaeden Tapia
date: 2013-12-12 19:55:34.000000000

Patch Set 3: Code-Review-1

(5 comments)

Also, we need to look into the possible problem with the manifest.mf getting updated because of the null annotation in the build.properties.

Line:54, lttng/org.eclipse.linuxtools.tmf.core/src/org/eclipse/linuxtools/tmf/core/statesystem/AbstractTmfStateProvider.java -> Could we make this private now?

Line:168, lttng/org.eclipse.linuxtools.tmf.core/src/org/eclipse/linuxtools/tmf/core/statesystem/AbstractTmfStateProvider.java -> I'd rather keep this "multi-thread" stuff out of this patch.

Line:231, lttng/org.eclipse.linuxtools.tmf.core/src/org/eclipse/linuxtools/tmf/core/statesystem/AbstractTmfStateProvider.java -> Again here more multi-thread stuff.

Line:317, lttng/org.eclipse.linuxtools.tmf.core/src/org/eclipse/linuxtools/internal/tmf/core/statesystem/backends/historytree/HistoryTree.java -> Maybe xxx@xxx.xxx here since the rest of the javadoc is there.

Line:59, lttng/org.eclipse.linuxtools.tmf.core/src/org/eclipse/linuxtools/tmf/core/statesystem/TmfStateSystemFactory.java -> which exception? Maybe add it to xxx@xxx.xxx line

-------------------------------------
author: Braxton Mccarthy
date: 2013-12-13 22:09:24.000000000

Patch Set 3:

Thanks a lot for the review Marc-Andr√©!

In fact this patch was waaaay too big to begin with. It's almost impossible to rebase now, so I will work on cutting it up in small pieces next, while integrating your comments.

For example, adding the package-info to one or few packages at a time (and to handle the case where null-ability "leaks" to other packages, we can xxx@xxx.xxx annotations temporarily until we make it the default for that package. Just sayin')

-------------------------------------
author: Braxton Mccarthy
date: 2013-12-13 23:43:46.000000000

Patch Set 3:

Also forgot to mention, I wasn't able to reproduce the "jdt.annotation package added automatically to Manifest" bug. What steps did you do to trigger it?

-------------------------------------
author: Kaeden Tapia
date: 2013-12-13 23:45:30.000000000

Patch Set 3:

"Also forgot to mention, I wasn't able to reproduce the "jdt.annotation package added automatically to Manifest" bug. What steps did you do to trigger it?"

I haven't seen the bug. Meredith Scott did. I added him as a reviewer, perhaps he can comment?

-------------------------------------
author: Braxton Mccarthy
date: 2014-01-17 22:59:16.000000000

Abandoned

This will be redone in smaller patches. xxx@xxx.xxx per class helps making each changeset more localized.

-------------------------------------
