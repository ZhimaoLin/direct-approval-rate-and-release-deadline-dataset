DESCRIPTION

[TMF][RFC] Batch Trace Import

Added a batch trace import wizard

Change-Id: I32bfa9c8f49e00d7e6741500c914f2816f4d7834
Signed-off-by: Ivy Mitchell xxx@xxx.xxx


COMMENTS

author: Ivy Mitchell
date: 2013-03-29 16:03:13.000000000

Uploaded patch set 3.

-------------------------------------
author: Brenden Conley
date: 2013-03-29 16:03:19.000000000

Patch Set 3:

Build Started https://hudson.eclipse.org/sandbox/job/linuxtools/1830/ 

-------------------------------------
author: Brenden Conley
date: 2013-03-29 16:22:41.000000000

Patch Set 3: Verified

Build Successful 

https://hudson.eclipse.org/sandbox/job/linuxtools/1830/ : SUCCESS

-------------------------------------
author: Kason Bridges
date: 2013-03-29 16:44:44.000000000

Patch Set 3: I would prefer that you didn't submit this

Corner case bug:

1- I check kernel trace, click next
2- I choose a directory, click next
3- Hmm, there should be more traces in here... oh, I should have clicked Generic CTF traces too because I also have some UST traces
4- click back twice
5- Check Generic CTF trace, click next twice (the directory I chose earlier is still there)
6- Result: the display of traces is not updated to reflect the new trace type I checked.

-------------------------------------
author: Kason Bridges
date: 2013-03-29 16:56:06.000000000

Patch Set 3: (3 inline comments)

I didn't look at it in details, but here are a few comments.

Line:67, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> Maybe change to fSelectTypePage or fSelectTraceTypePage ? And fSelectDirectoriesPage to be consistent.

Line:14, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/TraceToValidate.java -> Ctrl-shift-F

Line:21, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardTreeCellLabelProvider.java -> What is this for ?

-------------------------------------
author: Ricky Reeves
date: 2013-04-02 16:53:47.000000000

Patch Set 3: I would prefer that you didn't submit this

(24 inline comments)

General:
- Copy trace doesn't work -> link is created instead
- Deselected Overwrite button still overwrites the existing trace
-> If a trace already exist the user should be notified and asked to rename the trace since the table allows it and it also works :-) 
- Button Add File, Add Directory, Remove are not the same size 
- Table of files and directories should have alternating background (white, light gray) see my comment in previous review of patch set 1
- Wizard dialog box should have the a minimum size 
- Give feedback in message/error line why Finish button is not enabled (no trace selected)
- It is still possible to select a trace multiple times and finish importing. Only the last selected trace type is assigned.
- Compiler warnings (e.g. unused import, java-doc)
- Change the order of colums of scan page. First display the display name and in the second column use the trace. I think it's better because the "Trace to import" column is usually a long string and cannot be displayed.

2 Exceptions (first one when scanning big directory structure, second one when closing wizard)

java.lang.IllegalStateException: Queue full
	at java.util.AbstractQueue.add(AbstractQueue.java:71)
	at java.util.concurrent.ArrayBlockingQueue.add(ArrayBlockingQueue.java:209)
	at org.eclipse.linuxtools.tmf.ui.project.wizards.importtrace.BatchImportTraceWizard.UpdateFiles(BatchImportTraceWizard.java:477)
	at org.eclipse.linuxtools.tmf.ui.project.wizards.importtrace.BatchImportTraceWizard.AddFileToScan(BatchImportTraceWizard.java:289)
	at org.eclipse.linuxtools.tmf.ui.project.wizards.importtrace.ImportTraceWizardPageSelectDirectories$AddDirectoryHandler.widgetSelected(ImportTraceWizardPageSelectDirectories.java:180)
	at org.eclipse.swt.widgets.TypedListener.handleEvent(TypedListener.java:248)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1276)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3554)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3179)
	at org.eclipse.jface.window.Window.runEventLoop(Window.java:825)
	at org.eclipse.jface.window.Window.open(Window.java:801)
	at org.eclipse.linuxtools.internal.tmf.ui.project.handlers.BatchImportTraceHandler.execute(BatchImportTraceHandler.java:47)
	at org.eclipse.ui.internal.handlers.HandlerProxy.execute(HandlerProxy.java:290)
	at org.eclipse.ui.internal.handlers.E4HandlerProxy.execute(E4HandlerProxy.java:76)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.eclipse.e4.core.internal.di.MethodRequestor.execute(MethodRequestor.java:56)
	at org.eclipse.e4.core.internal.di.InjectorImpl.invokeUsingClass(InjectorImpl.java:229)
	at org.eclipse.e4.core.internal.di.InjectorImpl.invoke(InjectorImpl.java:210)
	at org.eclipse.e4.core.contexts.ContextInjectionFactory.invoke(ContextInjectionFactory.java:131)
	at org.eclipse.e4.core.commands.internal.HandlerServiceImpl.executeHandler(HandlerServiceImpl.java:171)
	at org.eclipse.e4.ui.workbench.renderers.swt.HandledContributionItem.executeItem(HandledContributionItem.java:814)
	at org.eclipse.e4.ui.workbench.renderers.swt.HandledContributionItem.handleWidgetSelection(HandledContributionItem.java:707)
	at org.eclipse.e4.ui.workbench.renderers.swt.HandledContributionItem.access$7(HandledContributionItem.java:691)
	at org.eclipse.e4.ui.workbench.renderers.swt.HandledContributionItem$4.handleEvent(HandledContributionItem.java:630)
	at org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:84)
	at org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1276)
	at org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:3554)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3179)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:1029)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:923)
	at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:86)
	at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:588)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:543)
	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:124)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:353)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:629)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:584)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1438)
	at org.eclipse.equinox.launcher.Main.main(Main.java:1414)


-------------------------------------------

org.eclipse.swt.SWTException: Failed to execute runnable (org.eclipse.swt.SWTException: Widget is disposed)
	at org.eclipse.swt.SWT.error(SWT.java:4361)
	at org.eclipse.swt.SWT.error(SWT.java:4276)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:138)
	at org.eclipse.swt.widgets.Display.runAsyncMessages(Display.java:3529)
	at org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:3182)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$9.run(PartRenderingEngine.java:1029)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:923)
	at org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:86)
	at org.eclipse.ui.internal.Workbench$5.run(Workbench.java:588)
	at org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:332)
	at org.eclipse.ui.internal.Workbench.createAndRunWorkbench(Workbench.java:543)
	at org.eclipse.ui.PlatformUI.createAndRunWorkbench(PlatformUI.java:149)
	at org.eclipse.ui.internal.ide.application.IDEApplication.start(IDEApplication.java:124)
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:196)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:353)
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:629)
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:584)
	at org.eclipse.equinox.launcher.Main.run(Main.java:1438)
	at org.eclipse.equinox.launcher.Main.main(Main.java:1414)
Caused by: org.eclipse.swt.SWTException: Widget is disposed
	at org.eclipse.swt.SWT.error(SWT.java:4361)
	at org.eclipse.swt.SWT.error(SWT.java:4276)
	at org.eclipse.swt.SWT.error(SWT.java:4247)
	at org.eclipse.swt.widgets.Widget.error(Widget.java:480)
	at org.eclipse.swt.widgets.Widget.checkWidget(Widget.java:417)
	at org.eclipse.swt.widgets.Tree.getItemCount(Tree.java:1509)
	at org.eclipse.jface.viewers.TreeViewer.getItemCount(TreeViewer.java:215)
	at org.eclipse.jface.viewers.CheckboxTreeViewer.preservingSelection(CheckboxTreeViewer.java:410)
	at org.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1506)
	at org.eclipse.jface.viewers.ColumnViewer.refresh(ColumnViewer.java:537)
	at org.eclipse.jface.viewers.StructuredViewer.refresh(StructuredViewer.java:1465)
	at org.eclipse.linuxtools.tmf.ui.project.wizards.importtrace.ImportTraceWizardPageScan$scanRunnable$UpdateUIRunnable.run(ImportTraceWizardPageScan.java:396)
	at org.eclipse.swt.widgets.RunnableLock.run(RunnableLock.java:35)
	at org.eclipse.swt.widgets.Synchronizer.runAsyncMessages(Synchronizer.java:135)
	... 24 more

Line:37, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/AbstractImportTraceWizardPage.java -> Fix java doc warnings

Line:41, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/AbstractImportTraceWizardPage.java -> Naming convention. Attributes should start with f. Also use better name (e.g. fImportWizard

Line:61, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageScan.java -> Sometimes when selecting a trace it is very slow to update the checkbox (It might be happening when having a big directory)

Line:152, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageScan.java -> please switch column 1 with column 2. It's more readable that way.

Line:191, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageScan.java -> de-selection doesn't seem to work. I wasn't able to copy.

Line:219, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageScan.java -> de-selection doesn't seem to work. The overwrite query in main wizard didn't work and trace was overwritten

Line:78, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageSelectDirectories.java -> se (SWT.H_SCROLL | SWT.V_SCROLL) instead of SWT.NONE style when constructing the table

Line:81, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageSelectDirectories.java -> Table of files and directories should have alternating background (white, light gray) see my comment in previous review

Line:33, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> Why is name public? You have a setter and getter. 
Also be consistent with naming convention (attributes should start with f)

Line:49, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> don't use one-letter variables

Line:138, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> It's not consistent. In equals the configuration element is also considered. And the name is not considered at all.

Consider this: 2 FileAndName instances with same file but different confguration element. The equals method will return false but the compareTo will return 0. That's not correct.

Line:150, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> shouldn't we also consider the name?

Line:182, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> shouldn't we also consider the name?

Line:61, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> Should we rename it to AdvancedImpotTraceWizard. If yes change also description

Line:90, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> Please organise your attributes, constants and methods. Keep constants together and also attributes. For methods, you mix private and public methods. I would prefer to keep public and private methods in different sections. BTW, applies for all your files.

Line:102, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> What are you actually storing in the dialog settings? You could store e.g. the last directory scanned.

Line:193, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> Don't have e.printStackTrace(). Use dialog box or/and log it to the error log of the plugin

Line:287, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> naming convention for methods: methods start with lower case

Line:308, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> naming convention for methods: methods start with lower case

Line:463, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/BatchImportTraceWizard.java -> naming convention for methods: methods start with lower case

Line:24, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardPageOptions.java -> Missing description

Line:7, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/Messages.java -> it would be better to have meaning full names instead of a number suffix.

Line:37, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportUtils.java -> Fix all compiler warnings

Line:56, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportUtils.java -> not used

-------------------------------------
author: Ivy Mitchell
date: 2013-04-04 21:19:25.000000000

Patch Set 3: (3 inline comments)

Putting up replies

Line:150, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> nope, see equals

Line:182, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/FileAndName.java -> Absolutely not!!! !!!! !!! (It was a small bug here) a trace file with a name that is changed is still the same trace file. It should not be scanned twice.

Line:21, lttng/org.eclipse.linuxtools.tmf.ui/src/org/eclipse/linuxtools/tmf/ui/project/wizards/importtrace/ImportTraceWizardTreeCellLabelProvider.java -> NOTHING! It is an artifact that should not be.

-------------------------------------
