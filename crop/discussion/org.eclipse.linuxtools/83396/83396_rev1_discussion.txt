DESCRIPTION

Bug 506109 - Add support to copy files from container to host

- add ContainerFileProxy class to model container file system
- add ContainerFileSelectionDialog for selecting files from
  running Container
- add DynamicCheckboxViewer that allows dynamic reading of the
  Container file system directories
- add checks to DockerConnection copyContainer method to fail
  if API >= 1.24
- add DockerConnection readContainerDirectory method
- save connection info for usage in DockerConnection methods
- copy over CheckboxTreeAndListGroup from platform
- add ContainerFileSystemProvider class which traverses the
  Container file system
- copy MinimizedFileSystemElement from platform
- copy PopulateRootFilesOperation from platform
- copy SelectFilesOperation from platform
- create PopulateContainerFilesPperation
- copy TarEntry, TarInputStream, and TarException classes from platform
- add CopyFromContainerCommandHandler
- add ContainerCopyFrom wizard and ContainerCopyFromPage
- add copy from container menu item to Docker Containers View

Change-Id: I5b928d6581e0ad4f8983866ad9d4bf12df7fc79b


COMMENTS

author: Kaylin Maxwell
date: 2016-10-17 21:34:00.000000000

Uploaded patch set 1.

-------------------------------------
author: Brenden Conley
date: 2016-10-17 21:34:06.000000000

Patch Set 1:

Build Started https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/11270/

-------------------------------------
author: Brenden Conley
date: 2016-10-17 21:52:13.000000000

Patch Set 1: Verified+1

Build Successful 

https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/11270/ : SUCCESS

-------------------------------------
author: Zechariah Krause
date: 2016-10-18 06:52:35.000000000

Patch Set 1: Code-Review-1

(22 comments)

Arianna Johns,

I commented on the sources with questions about potential NPE and other minor remarks. Also, I did not run the code, but I was wondering if you're using a job to retrieve the container files and avoid blocking the UI ?

Line:83, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/wizards/ContainerCopyFrom.java -> You could use the Stream API with something like:

this.sources = mainPage.getValues().stream().map(e -> ((ContainerFileProxy) e.getFileSystemObject()).getFullPath()).collect(Collectors.toList())

(and get rid of the 'copyList' variable)

Line:41, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> Why don't you use parameterized Sets and Lists in this class ? This brings type safety at compilation time.

Line:411, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> can 'elements' be 'null' ?

Line:453, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> there's no need for such a 'parent' variable here.

Line:519, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> Can this 'array' be 'null' ?

Line:18, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/TarEntry.java -> why 3.1 ?

Line:207, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/wizards/ContainerCopyFromPage.java -> Why don't you use the GridLayout ? I think the code would be simpler to maintain.

Line:132, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/commands/CopyFromContainerCommandHandler.java -> we should log the exceptions here.

Line:21, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/DynamicCheckboxTreeViewer.java -> this field can be final

Line:40, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/DynamicCheckboxTreeViewer.java -> Please use brackets, even for one-line blocks

Line:78, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateRootOperation.java -> you can join the 2 conditions in a single expression.

Line:81, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateRootOperation.java -> why do you allocate the 'children' variable ? If it's empty, there will be nothing to iterate on. So you could simplify the code with something like:

if(children != null) {
  children.stream.forEach(childrenEnum -> createElement(...));
}

Line:25, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> these fields can be 'final'

Line:34, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> Please return a parameterized List

Line:52, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> Should this comment be in the Javadoc, too ?

Line:63, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> Please remove this comment

Line:138, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSelectionDialog.java -> You can use the Stream.forEach(Consumer) to make code simpler

Line:26, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/TarException.java -> We should avoid exceptions with no message and no root cause, so I would suggest we remove this constructor.

Line:5, containers/org.eclipse.linuxtools.docker.core/src/org/eclipse/linuxtools/internal/docker/core/ContainerFileProxy.java -> these fields can be 'final'

Line:288, containers/org.eclipse.linuxtools.docker.core/src/org/eclipse/linuxtools/internal/docker/core/DockerConnection.java -> Why is the exception ignored ?

Line:18, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateContainerFilesOperation.java -> This field can be final

Line:30, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateContainerFilesOperation.java -> you should use a local variable instead of reallocating the argument, IMO.

-------------------------------------
author: Kaylin Maxwell
date: 2016-10-18 18:06:41.000000000

Patch Set 1:

(22 comments)

Line:83, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/wizards/ContainerCopyFrom.java -> Again, we are dealing with un-typed Lists so we cannot use this.  The interface from the older code simply provided the iterator.

Line:41, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> This code is taken directly from org.eclipse.ui.ide and this is typical of the older code in Eclipse.  The code still uses some public classes and interfaces to avoid it all being in Docker UI.  Those classes and interfaces don't parameterize collections.

Line:411, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> No.  It is at worst an empty list.

Line:453, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> Again, this code is from org.eclipse.ui.ide.  Yes, they could have passed currentTreeSelection, but it is really a nit.

Line:519, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/CheckboxTreeAndListGroup.java -> No.  It is at worst an empty array.

Line:18, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/TarEntry.java -> This was taken from another project so it had a since statement that I have now removed.

Line:207, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/wizards/ContainerCopyFromPage.java -> Done

Line:132, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/commands/CopyFromContainerCommandHandler.java -> Done

Line:21, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/DynamicCheckboxTreeViewer.java -> Done

Line:40, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/DynamicCheckboxTreeViewer.java -> Done

Line:78, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateRootOperation.java -> Done

Line:81, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateRootOperation.java -> I simplified and removed the empty ArrayList, however, stream does not work with un-typed List so I used an iterator.

Line:25, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> Done

Line:34, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> This is dictated by the IImportStructureProvider interface which is an untyped List.  These classes were written a while ago.

Line:52, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> No, but the javadoc mentions if you do not have the contents, return null.  I have updated the comment to mention that we do not have the contents of the container file.

Line:63, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSystemProvider.java -> Done

Line:138, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/ContainerFileSelectionDialog.java -> Java doesn't allow it for the un-typed collection that getInitialElementSelections() provides which is part of org.eclipse.ui.ide.SelectionDialog.

Line:26, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/TarException.java -> Done

Line:5, containers/org.eclipse.linuxtools.docker.core/src/org/eclipse/linuxtools/internal/docker/core/ContainerFileProxy.java -> Done

Line:288, containers/org.eclipse.linuxtools.docker.core/src/org/eclipse/linuxtools/internal/docker/core/DockerConnection.java -> I ignored it because it is only used for API versioning checking.  I have changed it to log the error.

Line:18, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateContainerFilesOperation.java -> Done

Line:30, containers/org.eclipse.linuxtools.docker.ui/src/org/eclipse/linuxtools/internal/docker/ui/PopulateContainerFilesOperation.java -> Done

-------------------------------------
author: Gerrit Code Review
date: 2016-10-18 21:53:11.000000000

Change has been successfully cherry-picked as b7fbdfb041dac8cb511fd889cabfd504f7e1cb2f by Kaylin Maxwell

-------------------------------------
