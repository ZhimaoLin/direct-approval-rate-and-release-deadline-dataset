DESCRIPTION

tmf : queryHistoryRange performance fix

This patch fix an unnecessary loop for the small resolution and increase the performance.

Benchmark :

Before :
Query resolution 1022444670: 0.245s
Query resolution 102244467: 1.167s
Query resolution 10224446: 3.390s
Query resolution 1022444: 4.028s
Query resolution 102244: 4.285s
Query resolution 10224: 5.451s
Query resolution 1022: 10.970s
Query resolution 102: 37.396s
Query resolution 10: 306.308s

Patch Set 1 :
Query resolution 1022444670: 0.278s
Query resolution 102244467: 1.138s
Query resolution 10224446: 3.373s
Query resolution 1022444: 3.976s
Query resolution 102244: 4.329s
Query resolution 10224: 5.309s
Query resolution 1022: 8.001s
Query resolution 102: 8.145s
Query resolution 10: 8.231s

Patch Set 2 :
Query resolution 1022444670: 0.253s
Query resolution 102244467: 1.084s
Query resolution 10224446: 3.488s
Query resolution 1022444: 4.262s
Query resolution 102244: 4.651s
Query resolution 10224: 5.428s
Query resolution 1022: 8.073s
Query resolution 102: 8.065s
Query resolution 10: 8.156s

Reference :
Performance with queryHistoryRange without resolution : 8.414s

Change-Id: I6022dc6c562d994310f9419c362dd1f06a414036
Signed-off-by: Ayanna Reed xxx@xxx.xxx


COMMENTS

author: Brenden Conley
date: 2014-01-29 18:35:42.000000000

Patch Set 4:

Build Started https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/5249/

-------------------------------------
author: Ayanna Reed
date: 2014-01-29 18:38:04.000000000

Patch Set 4:

Performance test update in the commit message.

We have a problem with the unit test :
testRangeQuery3() because we don't return the same intervals as Patrick says in the patch set 1 comment.

-------------------------------------
author: Brenden Conley
date: 2014-01-29 18:59:43.000000000

Patch Set 4: Verified-1

Build Failed 

https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/5249/ : FAILURE

-------------------------------------
author: Luciana Barry
date: 2014-01-29 21:11:33.000000000

Patch Set 4:

Yes, it's a real change in behavior. Depending on the characteristics of the data and the resolution, the patch set 2 might return many more intervals and make it slower, so maybe that change doesn't belong in a performance fix patch...

Also, probably the benchmark results doesn't belong in the final commit message, perhaps that should be in the review comments.

-------------------------------------
author: Ayanna Reed
date: 2014-01-29 21:38:27.000000000

Patch Set 4:

I'm aggree that in some particular cases we can have more intervals (the worst case is 2x). But the maximal number of interval are the same (ie : (t2-t1)/res).

-------------------------------------
