DESCRIPTION

ctf: Fix buffer overflow traces from crashing batch import

Buffer overflows are caused here by synthetic traces that aim to
behave maliciously. The parser already handles these attacks, but
the BufferOverflowException will cause the batch import trace wizard
to stop scanning. This fix catches buffer overflows in the validation
and warns that the error is serious.

Change-Id: Ie9156cfaac0944763e3d1dc798c42f1d64753560
Signed-off-by: Ivy Mitchell xxx@xxx.xxx


COMMENTS

author: Ivy Mitchell
date: 2013-06-26 19:35:25.000000000

Uploaded patch set 2.

-------------------------------------
author: Brenden Conley
date: 2013-06-26 19:35:31.000000000

Patch Set 2:

Build Started https://hudson.eclipse.org/sandbox/job/linuxtools/2779/

-------------------------------------
author: Brenden Conley
date: 2013-06-26 19:51:38.000000000

Patch Set 2: Verified+1

Build Successful 

https://hudson.eclipse.org/sandbox/job/linuxtools/2779/ : SUCCESS

-------------------------------------
author: Braxton Mccarthy
date: 2013-06-27 21:18:05.000000000

Patch Set 2:

Would it be possible to add a test, there is probably one of the test traces in the ctf-testsuite that triggers a buffer overflow?

-------------------------------------
author: Braxton Mccarthy
date: 2013-07-03 15:38:50.000000000

Patch Set 2: Code-Review-1

-1 to indicate it was looked at ;)

-------------------------------------
author: Kaeden Tapia
date: 2013-07-05 04:44:31.000000000

Patch Set 2: Code-Review-1

I think you need this in LttngKernelTrace as well. I get another exception:


java.nio.BufferOverflowException
	at org.eclipse.linuxtools.ctf.core.event.io.BitBuffer.getInt(BitBuffer.java:118)
	at org.eclipse.linuxtools.ctf.core.event.types.IntegerDefinition.read(IntegerDefinition.java:128)
	at org.eclipse.linuxtools.ctf.core.event.types.ArrayDefinition.read(ArrayDefinition.java:132)
	at org.eclipse.linuxtools.ctf.core.event.types.StructDefinition.read(StructDefinition.java:102)
	at org.eclipse.linuxtools.ctf.core.trace.CTFTrace.openStreamInput(CTFTrace.java:543)
	at org.eclipse.linuxtools.ctf.core.trace.CTFTrace.<init>(CTFTrace.java:206)
	at org.eclipse.linuxtools.ctf.core.trace.CTFTrace.<init>(CTFTrace.java:166)
	at org.eclipse.linuxtools.lttng2.kernel.core.trace.LttngKernelTrace.validate(LttngKernelTrace.java:71)
	at org.eclipse.linuxtools.tmf.ui.project.model.TraceTypeHelper.standardValidate(TraceTypeHelper.java:100)
	at org.eclipse.linuxtools.tmf.ui.project.model.TraceTypeHelper.validate(TraceTypeHelper.java:92)
	at org.eclipse.linuxtools.tmf.ui.project.model.TmfTraceType.validate(TmfTraceType.java:446)
	at org.eclipse.linuxtools.tmf.ui.project.model.TmfTraceType.validate(TmfTraceType.java:462)
	at org.eclipse.linuxtools.tmf.ui.project.wizards.importtrace.ImportTraceWizardScanPage$ScanRunnable.run(ImportTraceWizardScanPage.java:413)
	at org.eclipse.core.internal.jobs.Worker.run(Worker.java:53)

-------------------------------------
author: Kaeden Tapia
date: 2013-07-05 04:47:40.000000000

Patch Set 2:

Failing:
org.eclipse.linuxtools.ctf.core.tests/traces/ctf-testsuite/tests/1.8/fail/smalltrace

-------------------------------------
