DESCRIPTION

Systemtap: Pre-run autosave for projectless scripts.

When a Systemtap script that lacks a parent project is run,
either with the Run Script button on the toolbar or through
its editor's context menu (Run As->Systemtap Script), have
that script be immediately saved before the run begins.

Note that saving does not occur when a script is run with the
Run Configurations menu, or with the Run As button on the toolbar
and its associated keybinding.

This adds to the functionality of fa6613e, which only saves
scripts that belong to a project. This improvement also fixes a
bug introduced in that patch which caused a NullPointerException
when running a projectless script.

This patch also fixes a bug in fa6613e that allowed non-*.stp
files to be run as Systemtap scripts.

Change-Id: Ib0cc475e882ad9775fdaca44b1119089ca65638c
Signed-off-by: Landon Wilkins xxx@xxx.xxx


COMMENTS

author: Landon Wilkins
date: 2013-11-28 21:29:54.000000000

Uploaded patch set 2.

-------------------------------------
author: Brenden Conley
date: 2013-11-28 22:37:54.000000000

Patch Set 2:

Build Started https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/4281/

-------------------------------------
author: Brenden Conley
date: 2013-11-28 23:10:07.000000000

Patch Set 2: Verified+1

Build Successful 

https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/4281/ : SUCCESS

-------------------------------------
author: Nathanael Holden
date: 2013-11-29 15:15:36.000000000

Patch Set 2: Code-Review-1

(1 comment)

Line:147, systemtap/org.eclipse.linuxtools.systemtap.ui.ide/src/org/eclipse/linuxtools/internal/systemtap/ui/ide/actions/RunScriptHandler.java -> Have you tried HandlerUtil.getActiveEditor(event) . I believe the ExecutionEvent should contain information about the state of events (what was selected, had focus, etc.) when the handler was triggered.

-------------------------------------
author: Landon Wilkins
date: 2013-11-29 18:44:25.000000000

Patch Set 2:

(1 comment)

Line:147, systemtap/org.eclipse.linuxtools.systemtap.ui.ide/src/org/eclipse/linuxtools/internal/systemtap/ui/ide/actions/RunScriptHandler.java -> Regardless of how I run a script, the event that gets passed to this method is always null.

Also, I once tried using ResourceUtil.findEditor(page, file) but found it didn't work for files outside the workspace.

-------------------------------------
author: Nathanael Holden
date: 2013-11-29 19:03:56.000000000

Patch Set 2:

(1 comment)

Line:147, systemtap/org.eclipse.linuxtools.systemtap.ui.ide/src/org/eclipse/linuxtools/internal/systemtap/ui/ide/actions/RunScriptHandler.java -> Yes, I see that now. This is because it's called in the delegate with action.execute(null); In this case the actual entry point into linuxtools code happens at SystemTapScriptLaunchShortcut.launch(IEditorPart editor, String mode). From there you have access to the IEditorPart from which the launch happened. Could the saving/actions that need the IEditorPart/IEditorInput be done at that point ?

However if you click the "Run" icon the ExecutionEvent should be properly populated, so both cases (event == null vs. event != null) can be handled.

-------------------------------------
author: Landon Wilkins
date: 2013-11-29 19:38:24.000000000

Patch Set 2:

(1 comment)

Line:147, systemtap/org.eclipse.linuxtools.systemtap.ui.ide/src/org/eclipse/linuxtools/internal/systemtap/ui/ide/actions/RunScriptHandler.java -> SystemTapScriptLaunchShortcut.launch(IEditorPart editor, String mode) isn't used if a run is executed in a way that doesn't check an editor to find which script file to run.

Some examples include starting a run while in the Run Configurations menu, or right-clicking a file in the Package Explorer and choosing "Run As->Stap Script".

Considering that editor information isn't always provided/available during any means of starting a script, it might be best to just check everything explicitly to cover all cases.

-------------------------------------
author: Gerrit Code Review
date: 2013-11-29 21:48:08.000000000

The change could not be merged due to a path conflict.

Please rebase the change locally and upload the rebased commit for review.

-------------------------------------
