DESCRIPTION

ctf: [rfc][icantstop] add Event header data types

This is a complex datatype described in the examples of the ctf spec.
Right chances are many people will re-use this pattern so why not
enhance its performance.

Change-Id: I2042be35fee38e42680691af879357ebb1aff95b
Signed-off-by: Ivy Mitchell xxx@xxx.xxx


COMMENTS

author: Ivy Mitchell
date: 2014-05-04 23:27:34.000000000

Uploaded patch set 1.

-------------------------------------
author: Brenden Conley
date: 2014-05-04 23:27:40.000000000

Patch Set 1:

Build Started https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/6842/

-------------------------------------
author: Ivy Mitchell
date: 2014-05-04 23:29:26.000000000

Topic set to CTF performance

-------------------------------------
author: Ivy Mitchell
date: 2014-05-04 23:31:14.000000000

Patch Set 1:

This patch improves the CTF parser performance by about 25% over all the other patchs, bringing the total performance improvement to 66% on my c2q with 4g ram and a 2 tb wd black hdd

-------------------------------------
author: Brenden Conley
date: 2014-05-04 23:38:46.000000000

Patch Set 1: Verified-1

Build Failed 

https://hudson.eclipse.org/linuxtools/job/linuxtools-gerrit/6842/ : FAILURE

-------------------------------------
author: Ivy Mitchell
date: 2014-05-05 00:14:44.000000000

Patch Set 1:

I should clarify the performance... the whole patchset (25861->25924->25925->25926->this) lowers the even read time from 2.5 us to 1 us per event on an older machine.

-------------------------------------
author: Kaeden Tapia
date: 2014-05-06 21:41:33.000000000

Patch Set 1: Code-Review-1

(1 comment)

Line:10, /COMMIT_MSG -> Right chances? Did you mean Right now, chances?

-------------------------------------
author: Braxton Mccarthy
date: 2014-06-17 19:31:51.000000000

Patch Set 1: Code-Review-1

(27 comments)

Makes sense to have the headers as a separate type. Might be worth having an abstract EventHeader type too (and all put them in a types.header package).

Line:9, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> separate line

Line:10, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> add empty line after

Line:18, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> You can remove "lttng" in this sentence, it is still generic at this point.

Line:19, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> CTF

LTTng

Line:40, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> 3.1 now?

Line:42, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> add empty line after

Line:69, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> use private static defines for those int literals (5, 8, 27, 32, 64, 104, etc.)

Line:79, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderCompactDecl.java -> isCompactEventHeader() would be more clear

Line:1, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> copyright header

Line:7, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> CTF

Line:10, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> 3.1

Line:11, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> remove empty line

Line:17, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> remove

Line:34, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderDef.java -> do we always use Compact header declarations for this? If so, why don't we have both a CompactHeaderDef and a LargeHeaderDef? If not, then the parameter should be called "eventHeaderDecl" only (and use the abstract type mentioned in the following file).

Line:117, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/trace/StreamInputPacketReader.java -> formatting update should go in a separate patch

Line:9, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> separate line

Line:10, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> add empty line

Line:18, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> Don't say Lttng here

Line:19, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> CTF, LTTng

Line:40, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> 3.1

Line:42, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> add empty line below

Line:47, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> should it be worth having a abstract EventHeaderDeclaration for those? If they are all in the same package, wouldn't be so bad.

Could also put the common part of the IsA...() methods in there too.

Line:69, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> private static final defines

Line:79, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/event/types/EventHeaderLargeDecl.java -> isLargeEventHeader()

Line:848, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/internal/ctf/core/event/metadata/IOStructGen.java -> formatting in a separate patch

Line:51, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/trace/Stream.java -> (Abstract)EventHeaderDecl?

Line:141, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/trace/Stream.java -> 3.1

-------------------------------------
author: Ivy Mitchell
date: 2014-08-08 19:10:46.000000000

Patch Set 1:

(2 comments)

Line:147, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/trace/StreamInputPacketReader.java -> api break

Line:51, lttng/org.eclipse.linuxtools.ctf.core/src/org/eclipse/linuxtools/ctf/core/trace/Stream.java -> could still be a struct

-------------------------------------
